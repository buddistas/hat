<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ª—è–ø–∞ - –ò–≥—Ä–∞ –≤ —Å–ª–æ–≤–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .screen {
            display: none;
            flex: 1;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        .setup-form {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 16px;
        }

        .btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            text-align: center;
            min-height: 0; /* –ü–æ–∑–≤–æ–ª—è–µ—Ç flex-—ç–ª–µ–º–µ–Ω—Ç–∞–º —Å–∂–∏–º–∞—Ç—å—Å—è */
        }

        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            min-height: 0;
        }

        .current-word {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 0;
            background: transparent; /* –¥–µ–ª–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ–≤–∏–¥–∏–º—ã–º */
            border-radius: 0;
            backdrop-filter: none;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 0 2px 0 rgba(0,0,0,0.15), 0 4px 10px rgba(0,0,0,0.2);
            word-break: keep-all; /* –ù–µ —Ä–∞–∑—Ä—ã–≤–∞–µ–º —Å–ª–æ–≤–∞ –ø–æ —Å–ª–æ–≥–∞–º */
            white-space: normal; /* –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ */
            overflow-wrap: break-word; /* –ü–µ—Ä–µ–Ω–æ—Å–∏–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ */
            width: 100%;
            text-align: center;
            line-height: 1.2; /* –£–ª—É—á—à–∞–µ–º —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ —Å—Ç—Ä–æ–∫ */
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —É–≥–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞ */
        .compact-btn {
            position: fixed;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            font-size: 18px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .compact-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .compact-btn:active {
            transform: scale(0.95);
        }

        .pause-btn {
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .pause-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .end-btn {
            top: 15px;
            right: 15px;
            background: rgba(244,67,54,0.8);
            color: white;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(244,67,54,0.9);
        }

        .end-btn:hover {
            background: rgba(244,67,54,0.9);
        }

        .game-controls-top {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: flex-end;
        }

        .game-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            width: 100%;
            max-width: 350px;
            flex-shrink: 0; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–æ–∫ */
        }

        .game-controls .btn {
            flex: 1;
            margin: 0;
            padding: 20px;
            font-size: 16px;
        }

        .btn-small {
            padding: 8px 16px !important;
            font-size: 14px !important;
            margin: 0 !important;
            flex: none !important;
        }

        .btn-success {
            background: #4caf50;
        }

        .btn-success:hover {
            background: #45a049;
        }

        .btn-warning {
            background: #ff9800;
        }

        .btn-warning:hover {
            background: #f57c00;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .scores {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .score-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            min-width: 100px;
        }

        .score-item h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .score-item .score {
            font-size: 2rem;
            font-weight: bold;
            color: #ffeb3b;
        }

        .round-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .player-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .words-counter {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: 600;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 10px 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .words-counter:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-1px);
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .connection-status.connected {
            background: #4caf50;
            color: white;
        }

        .connection-status.disconnected {
            background: #f44336;
            color: white;
        }

        .results {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .results h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .winner {
            text-align: center;
            margin: 20px 0;
            font-size: 1.5rem;
            color: #ffeb3b;
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-navigation {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .stats-navigation .btn {
            padding: 10px 20px;
            font-size: 0.9em;
            min-width: 100px;
        }

        .stats-navigation .btn-active {
            background: #4CAF50;
            color: white;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-table-container {
            margin: 20px auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 700px;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            font-size: 0.9em;
            margin: 0 auto;
        }

        .stats-table th {
            background: #f5f5f5;
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid #ddd;
            color: #333;
        }

        .stats-table td {
            padding: 10px 8px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        /* –ß–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–º–µ–Ω –∏ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–æ–º–∞–Ω–¥ */
        .stats-table td:first-child {
            color: #333;
        }


        .stats-table tbody tr:hover {
            background: #f9f9f9;
        }

        .stats-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–∫–æ–≤ */
        .score-positive {
            color: #4CAF50;
            font-weight: bold;
        }

        .score-negative {
            color: #f44336;
            font-weight: bold;
        }

        .score-zero {
            color: #666;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .stats-table {
                font-size: 0.75em;
            }
            
            .stats-table th,
            .stats-table td {
                padding: 6px 3px;
            }
            
            .stats-navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .stats-navigation .btn {
                width: 200px;
            }
            
            /* –î–µ–ª–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .stats-table th:nth-child(1),
            .stats-table td:nth-child(1) {
                min-width: 80px;
            }
            
            .stats-table th:nth-child(2),
            .stats-table td:nth-child(2) {
                min-width: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-table {
                font-size: 0.7em;
            }
            
            .stats-table th,
            .stats-table td {
                padding: 4px 2px;
            }
        }

        .team-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .teams-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .teams-container::-webkit-scrollbar {
            width: 6px;
        }

        .teams-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .teams-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .teams-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        .team-item h3 {
            margin-bottom: 10px;
            color: #ffeb3b;
            font-size: 1.1rem;
        }

        .team-players {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .player-tag {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .player-intro-info {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
            animation: playerIntroSlideIn 0.8s ease-out;
        }

        .handoff-info {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .current-player-info {
            margin: 30px 0;
            animation: playerInfoFadeIn 1s ease-out 0.3s both;
        }

        .current-player-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            animation: playerNameGlow 2s ease-in-out infinite;
        }

        .current-player-team {
            font-size: 1.3rem;
            opacity: 0.9;
            color: white;
            animation: playerTeamSlideIn 0.8s ease-out 0.5s both;
        }

        .next-player-info {
            margin: 30px 0;
        }

        .next-player-name {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .next-player-team {
            font-size: 1.3rem;
            opacity: 0.9;
            color: white;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –ø—Ä–∞–≤–∏–ª */
        .rules-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .rules-content {
            background: rgba(255,255,255,0.1);
            border-radius: 25px;
            padding: 40px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255,255,255,0.2);
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: rulesSlideIn 0.8s ease-out;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .rules-header {
            margin-bottom: 40px;
            animation: rulesHeaderFadeIn 1s ease-out 0.3s both;
        }

        .rules-title {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #ffeb3b, #ff9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rules-subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            color: #ffeb3b;
            font-weight: 600;
        }

        .rules-body {
            margin-bottom: 40px;
        }

        .rule-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            animation: ruleItemSlideIn 0.6s ease-out both;
            transition: all 0.3s ease;
        }

        .rule-item:nth-child(1) { animation-delay: 0.5s; }
        .rule-item:nth-child(2) { animation-delay: 0.7s; }
        .rule-item:nth-child(3) { animation-delay: 0.9s; }

        .rule-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .rule-icon {
            font-size: 2.5rem;
            margin-right: 20px;
            flex-shrink: 0;
            animation: ruleIconBounce 1s ease-out both;
        }

        .rule-item:nth-child(1) .rule-icon { animation-delay: 0.6s; }
        .rule-item:nth-child(2) .rule-icon { animation-delay: 0.8s; }
        .rule-item:nth-child(3) .rule-icon { animation-delay: 1s; }

        .rule-text {
            text-align: left;
            flex: 1;
        }

        .rule-text h3 {
            font-size: 1.2rem;
            margin-bottom: 8px;
            color: #ffeb3b;
            font-weight: 600;
        }

        .rule-text p {
            font-size: 1rem;
            line-height: 1.5;
            opacity: 0.9;
        }

        .rules-btn {
            background: linear-gradient(45deg, #4caf50, #45a049);
            font-size: 1.2rem;
            padding: 18px 40px;
            border-radius: 30px;
            animation: rulesBtnPulse 2s ease-in-out infinite;
            box-shadow: 0 10px 20px rgba(76,175,80,0.3);
            transition: all 0.3s ease;
        }

        .rules-btn:hover {
            background: linear-gradient(45deg, #45a049, #4caf50);
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(76,175,80,0.4);
        }

        .rules-btn:active {
            transform: translateY(-1px);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes rulesSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes rulesHeaderFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes ruleItemSlideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes ruleIconBounce {
            0% {
                opacity: 0;
                transform: scale(0.3) rotate(-10deg);
            }
            50% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        @keyframes rulesBtnPulse {
            0%, 100% {
                box-shadow: 0 10px 20px rgba(76,175,80,0.3);
            }
            50% {
                box-shadow: 0 15px 30px rgba(76,175,80,0.5);
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ */
        @keyframes playerIntroSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes playerInfoFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes playerNameGlow {
            0%, 100% {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 20px rgba(255,235,59,0.3);
            }
            50% {
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 30px rgba(255,235,59,0.6);
            }
        }

        @keyframes playerTeamSlideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 0.9;
                transform: translateX(0);
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .current-word {
                font-size: 2rem;
                padding: 15px;
                word-break: keep-all; /* –ù–µ —Ä–∞–∑—Ä—ã–≤–∞–µ–º —Å–ª–æ–≤–∞ –ø–æ —Å–ª–æ–≥–∞–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
                line-height: 1.3; /* –ù–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –º–µ–∂—Å—Ç—Ä–æ—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
            
            .game-controls {
                flex-direction: column;
                max-width: 100%;
            }

            /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .compact-btn {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }

            .pause-btn {
                top: 10px;
                left: 10px;
            }

            .end-btn {
                top: 10px;
                right: 10px;
            }

            .game-controls-top {
                flex-direction: column;
                gap: 8px;
            }

            .teams-container {
                max-height: 300px;
            }

            .player-tag {
                font-size: 12px;
                padding: 4px 8px;
            }

            .team-item {
                padding: 12px;
            }

            .team-item h3 {
                font-size: 1rem;
            }

            /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–æ–≤ –ø—Ä–∞–≤–∏–ª –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .rules-content {
                padding: 25px;
                margin: 10px;
            }

            .rules-title {
                font-size: 2.2rem;
            }

            .rules-subtitle {
                font-size: 1.1rem;
            }

            .rule-item {
                flex-direction: column;
                text-align: center;
                padding: 15px;
            }

            .rule-icon {
                margin-right: 0;
                margin-bottom: 10px;
                font-size: 2rem;
            }

            .rule-text {
                text-align: center;
            }

            .rule-text h3 {
                font-size: 1.1rem;
            }

            .rule-text p {
                font-size: 0.9rem;
            }

            .rules-btn {
                font-size: 1.1rem;
                padding: 15px 30px;
            }

            /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .player-intro-info {
                padding: 25px;
                margin: 10px;
            }

            .current-player-name {
                font-size: 2rem;
            }

            .current-player-team {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
    
    <div class="container">
        <div class="header">
            <h1>üé© –®–ª—è–ø–∞</h1>
            <p>–ò–≥—Ä–∞ –≤ —Å–ª–æ–≤–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</p>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞—É–¥–∏–æ -->
        <div class="screen active" id="audioUnlockScreen">
            <div class="setup-form">
                <h2 style="text-align: center; margin-bottom: 30px;">üéµ –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫</h2>
                <p style="text-align: center; margin-bottom: 30px; font-size: 1.1rem; opacity: 0.9;">
                    –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ –æ–ø—ã—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫.<br>
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ.
                </p>
                <button class="btn" onclick="buttonClick(enableAudio)">üîä –í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫</button>
                <button class="btn btn-secondary" onclick="buttonClick(skipAudio)" style="margin-top: 15px;">üîá –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ –∑–≤—É–∫–∞</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã -->
        <div class="screen" id="setupScreen">
            <div class="setup-form">
                <h2 style="text-align: center; margin-bottom: 30px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
                
                <div class="form-group">
                    <label for="playerCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤:</label>
                    <select id="playerCount">
                        <option value="4">4 –∏–≥—Ä–æ–∫–∞</option>
                        <option value="5">5 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="6">6 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="7">7 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="8">8 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="9">9 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="10">10 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="11">11 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="12">12 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="13">13 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="14">14 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="15">15 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="16">16 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="17">17 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="18">18 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="19">19 –∏–≥—Ä–æ–∫–æ–≤</option>
                        <option value="20">20 –∏–≥—Ä–æ–∫–æ–≤</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="teamCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥:</label>
                    <select id="teamCount">
                        <option value="2">2 –∫–æ–º–∞–Ω–¥—ã</option>
                        <option value="3">3 –∫–æ–º–∞–Ω–¥—ã</option>
                        <option value="4">4 –∫–æ–º–∞–Ω–¥—ã</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="roundDuration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ö–æ–¥–∞ (—Å–µ–∫—É–Ω–¥—ã):</label>
                    <select id="roundDuration">
                        <option value="30" selected>30 —Å–µ–∫—É–Ω–¥</option>
                        <option value="60">60 —Å–µ–∫—É–Ω–¥</option>
                        <option value="90">90 —Å–µ–∫—É–Ω–¥</option>
                    </select>
                </div>

                <button class="btn" onclick="buttonClick(setupTeams)">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–∞–Ω–¥ -->
        <div class="screen" id="teamsScreen">
            <div class="setup-form">
                <h2 style="text-align: center; margin-bottom: 30px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥</h2>
                
                <div class="form-group">
                    <label>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:</label>
                    <div class="teams-container">
                        <div id="teamsList" style="margin-top: 15px;"></div>
                    </div>
                    <button class="btn btn-secondary" onclick="buttonClick(shuffleTeams)" style="margin-top: 15px;">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã</button>
                </div>

                <button class="btn" onclick="buttonClick(setupWords)">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–æ–≤–∞</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ–≤ -->
        <div class="screen" id="wordsScreen">
            <div class="setup-form">
                <h2 style="text-align: center; margin-bottom: 30px;">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–æ–≤</h2>
                
                <div class="form-group">
                    <label for="wordsCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤ –≤ —à–ª—è–ø–µ:</label>
                    <select id="wordsCount">
                        <option value="20">20 —Å–ª–æ–≤</option>
                        <option value="30">30 —Å–ª–æ–≤</option>
                        <option value="40">40 —Å–ª–æ–≤</option>
                        <option value="50">50 —Å–ª–æ–≤</option>
                        <option value="60">60 —Å–ª–æ–≤</option>
                        <option value="70">70 —Å–ª–æ–≤</option>
                        <option value="80">80 —Å–ª–æ–≤</option>
                        <option value="90">90 —Å–ª–æ–≤</option>
                        <option value="100" selected>100 —Å–ª–æ–≤</option>
                        <option value="120">120 —Å–ª–æ–≤</option>
                        <option value="140">140 —Å–ª–æ–≤</option>
                        <option value="160">160 —Å–ª–æ–≤</option>
                        <option value="180">180 —Å–ª–æ–≤</option>
                        <option value="200">200 —Å–ª–æ–≤</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="display:block; margin-bottom: 8px;">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                    <div id="categoriesContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; padding: 6px; border: 1px solid rgba(255,255,255,0.15); border-radius: 12px;"></div>
                    <div style="margin-top: 12px; display: flex; gap: 10px; flex-wrap: wrap; align-items:center;">
                        <button type="button" class="btn" style="padding: 6px 10px;" onclick="selectAllCategories(true)">–í—ã–±—Ä–∞—Ç—å –≤—Å–µ</button>
                        <button type="button" class="btn" style="padding: 6px 10px;" onclick="selectAllCategories(false)">–°–±—Ä–æ—Å–∏—Ç—å</button>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display:block; margin-bottom: 8px;">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                    <div style="display:flex; align-items:center; justify-content:center; gap:12px; width:100%;">
                        <span style="opacity:0.85; font-size:14px;">–ù–æ—Ä–º–∞–ª—å–Ω–∞—è</span>
                        <label style="position:relative; display:inline-block; width:60px; height:34px;">
                            <input type="checkbox" id="difficultyToggle" name="difficulty" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å: –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è/–ø–æ–≤—ã—à–µ–Ω–Ω–∞—è" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å" checked style="position:absolute; top:0; left:0; width:100%; height:100%; margin:0; opacity:0;">
                            <span style="position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#666; transition:.2s; border-radius:34px;"></span>
                            <span style="position:absolute; content:''; height:26px; width:26px; left:4px; bottom:4px; background-color:#fff; transition:.2s; border-radius:50%;" id="difficultyKnob"></span>
                        </label>
                        <span style="opacity:0.85; font-size:14px;">–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è</span>
                    </div>
                    <!-- –°–ª–∞–π–¥–µ—Ä –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤ -->
                    <div style="margin-top: 14px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
                            <label for="difficultySlider" style="opacity:0.9;">–ü—Ä–æ—Ü–µ–Ω—Ç —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤</label>
                            <span id="difficultySliderValue" style="opacity:0.9; font-variant-numeric: tabular-nums;">25%</span>
                        </div>
                        <input type="range" id="difficultySlider" min="0" max="100" step="5" value="25" style="width:100%;" disabled>
                    </div>
                </div>

                <div class="form-group">
                    <p style="text-align: center; opacity: 0.8; font-size: 14px; margin-top: 10px;">
                        –°–ª–æ–≤–∞ –±—É–¥—É—Ç –≤—ã–±—Ä–∞–Ω—ã —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —É—Ä–æ–≤–Ω–µ–π
                    </p>
                </div>

                <button class="btn" onclick="buttonClick(startGame)">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div class="screen" id="gameScreen">
            <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —É–≥–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞ -->
            <button class="compact-btn pause-btn" onclick="pauseGame()" id="pauseBtn">‚è∏Ô∏è</button>
            <button class="compact-btn end-btn" onclick="endGame()">‚úï</button>
            
            <div class="round-info" id="roundInfo" style="font-weight: bold; font-size: 1.2em; color: #ffffff;">–¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥: 1 –∏–∑ 3</div>
            <div class="player-info" id="playerInfo">–•–æ–¥ –∏–≥—Ä–æ–∫–∞</div>
            <div class="words-counter" id="wordsCounter">–ï—â–µ —Å–ª–æ–≤ - 99</div>
            
            <div class="game-area">
                <div class="game-content">
                    <div class="timer" id="timer">30</div>
                    <div class="current-word" id="currentWord">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å–∫" –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–ª–æ–≤–∞</div>
                </div>
                
                <div class="game-controls">
                    <button class="btn btn-success" onclick="wordGuessed()">–í–µ—Ä–Ω–æ</button>
                    <button class="btn btn-warning" onclick="wordPassed()">–ü—Ä–æ–ø—É—Å–∫</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ -->
        <div class="screen" id="playerIntroScreen">
            <div class="game-area">
                <div class="player-intro-info">
                    <h2 style="text-align: center; margin-bottom: 30px; color: #ffeb3b;">–•–æ–¥ –∏–≥—Ä–æ–∫–∞</h2>
                    <div class="current-player-info">
                        <div class="current-player-name" id="currentPlayerName">–ò–≥—Ä–æ–∫</div>
                        <div class="current-player-team" id="currentPlayerTeam">–ö–æ–º–∞–Ω–¥–∞</div>
                    </div>
                    <div class="player-intro-message">
                        <p style="text-align: center; font-size: 1.2rem; margin: 30px 0; opacity: 0.9;">
                            –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å —Ö–æ–¥?
                        </p>
                    </div>
                    <button class="btn" onclick="buttonClick(startPlayerTurn)" id="startPlayerTurnBtn">–ù–∞—á–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø–µ—Ä–µ–¥–∞—á–∏ —Ö–æ–¥–∞ -->
        <div class="screen" id="handoffScreen">
            <div class="game-area">
                <div class="handoff-info">
                    <h2 style="text-align: center; margin-bottom: 30px; color: #ffeb3b;">–ü–µ—Ä–µ–¥–∞—á–∞ —Ö–æ–¥–∞</h2>
                    <div class="next-player-info">
                        <div class="next-player-name" id="nextPlayerName">–ò–≥—Ä–æ–∫</div>
                        <div class="next-player-team" id="nextPlayerTeam">–ö–æ–º–∞–Ω–¥–∞</div>
                    </div>
                    <div class="handoff-message">
                        <p style="text-align: center; font-size: 1.2rem; margin: 30px 0; opacity: 0.9;">
                            –ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å —Ö–æ–¥?
                        </p>
                    </div>
                    <button class="btn" onclick="buttonClick(startNextTurn)" id="startTurnBtn">–°—Ç–∞—Ä—Ç</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Å—á–µ—Ç–∞ –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏ -->
        <div class="screen" id="roundScoresScreen">
            <div class="results">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞</h2>
                <div class="scores" id="roundScores"></div>
                
                <button class="btn" onclick="buttonClick(continueToNextRound)" id="continueBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª 1-–≥–æ —Ä–∞—É–Ω–¥–∞ -->
        <div class="screen" id="rulesScreen1">
            <div class="rules-container">
                <div class="rules-content">
                    <div class="rules-header">
                        <h1 class="rules-title">üéØ –†–∞—É–Ω–¥ 1</h1>
                        <div class="rules-subtitle">–°–≤–æ–±–æ–¥–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ</div>
                    </div>
                    
                    <div class="rules-body">
                        <div class="rule-item">
                            <div class="rule-icon">üí¨</div>
                            <div class="rule-text">
                                <h3>–û–±—ä—è—Å–Ω—è–π—Ç–µ —Å–ª–æ–≤–∞ —Å–ª–æ–≤–∞–º–∏</h3>
                                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –Ω–æ –Ω–µ –Ω–∞–∑—ã–≤–∞–π—Ç–µ —Å–∞–º–æ —Å–ª–æ–≤–æ –∏–ª–∏ –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</p>
                            </div>
                        </div>
                        
                        <div class="rule-item">
                            <div class="rule-icon">üö´</div>
                            <div class="rule-text">
                                <h3>–ó–∞–ø—Ä–µ—â–µ–Ω–æ</h3>
                                <p>–ñ–µ—Å—Ç—ã, –º–∏–º–∏–∫–∞, –∑–≤—É–∫–∏, —Å–æ–∑–≤—É—á–∏—è –∏ –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞</p>
                            </div>
                        </div>
                        
                        
                    </div>
                    
                    <button class="btn rules-btn" onclick="buttonClick(startFirstRound)">–Ø—Å–Ω–æ</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª 2-–≥–æ —Ä–∞—É–Ω–¥–∞ -->
        <div class="screen" id="rulesScreen2">
            <div class="rules-container">
                <div class="rules-content">
                    <div class="rules-header">
                        <h1 class="rules-title">üé≠ –†–∞—É–Ω–¥ 2</h1>
                        <div class="rules-subtitle">–ñ–µ—Å—Ç—ã –∏ –º–∏–º–∏–∫–∞</div>
                    </div>
                    
                    <div class="rules-body">
                        <div class="rule-item">
                            <div class="rule-icon">ü§≤</div>
                            <div class="rule-text">
                                <h3>–¢–æ–ª—å–∫–æ –∂–µ—Å—Ç—ã –∏ –º–∏–º–∏–∫–∞</h3>
                                <p>–û–±—ä—è—Å–Ω—è–π—Ç–µ —Å–ª–æ–≤–∞ –∂–µ—Å—Ç–∞–º–∏, –º–∏–º–∏–∫–æ–π –∏ –¥–≤–∏–∂–µ–Ω–∏—è–º–∏ —Ç–µ–ª–∞</p>
                            </div>
                        </div>
                        
                        <div class="rule-item">
                            <div class="rule-icon">üö´</div>
                            <div class="rule-text">
                                <h3>–°–ª–æ–≤–∞ –∑–∞–ø—Ä–µ—â–µ–Ω—ã!</h3>
                                <p>–ù–∏–∫–∞–∫–∏—Ö —Å–ª–æ–≤, –∑–≤—É–∫–æ–≤ –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫</p>
                            </div>
                        </div>
                        
                        
                    </div>
                    
                    <button class="btn rules-btn" onclick="buttonClick(startSecondRound)">–Ø—Å–Ω–æ</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª 3-–≥–æ —Ä–∞—É–Ω–¥–∞ -->
        <div class="screen" id="rulesScreen3">
            <div class="rules-container">
                <div class="rules-content">
                    <div class="rules-header">
                        <h1 class="rules-title">üéØ –†–∞—É–Ω–¥ 3</h1>
                        <div class="rules-subtitle">–û–¥–Ω–æ —Å–ª–æ–≤–æ</div>
                    </div>
                    
                    <div class="rules-body">
                        <div class="rule-item">
                            <div class="rule-icon">üìù</div>
                            <div class="rule-text">
                                <h3>–¢–æ–ª—å–∫–æ –æ–¥–Ω–æ —Å–ª–æ–≤–æ</h3>
                                <p>–û–±—ä—è—Å–Ω—è–π—Ç–µ –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º-–∞—Å—Å–æ—Ü–∏–∞—Ü–∏–µ–π</p>
                            </div>
                        </div>
                        
                        <div class="rule-item">
                            <div class="rule-icon">üéØ</div>
                            <div class="rule-text">
                                <h3>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ</h3>
                                <p>–í—ã–±–∏—Ä–∞–π—Ç–µ —Å–∞–º–æ–µ —Ç–æ—á–Ω–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è</p>
                            </div>
                        </div>
                        
                        
                    </div>
                    
                    <button class="btn rules-btn" onclick="buttonClick(startThirdRound)">–Ø—Å–Ω–æ</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–∞–Ω–¥ -->
        <div class="screen" id="teamResultsScreen">
            <div class="results">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥</h2>
                <div class="winner" id="winner"></div>
                
                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div class="stats-navigation">
                    <button class="btn btn-active" onclick="buttonClick(showTeamStats)">–ö–æ–º–∞–Ω–¥—ã</button>
                    <button class="btn" onclick="buttonClick(showPlayerStats)">–ò–≥—Ä–æ–∫–∏</button>
                </div>
                
                <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–æ–º–∞–Ω–¥ -->
                <div class="stats-table-container">
                    <table class="stats-table" id="teamStatsTable">
                        <thead>
                            <tr>
                                <th>–ö–æ–º–∞–Ω–¥–∞</th>
                                <th>–†–∞—É–Ω–¥ 1</th>
                                <th>–†–∞—É–Ω–¥ 2</th>
                                <th>–†–∞—É–Ω–¥ 3</th>
                                <th>–ò—Ç–æ–≥–æ</th>
                            </tr>
                        </thead>
                        <tbody id="teamStatsBody">
                        </tbody>
                    </table>
                </div>
                
                <button class="btn" onclick="buttonClick(newGame)">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä–æ–∫–æ–≤ -->
        <div class="screen" id="playerResultsScreen">
            <div class="results">
                <h2>–õ–∏—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                
                <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
                <div class="stats-navigation">
                    <button class="btn" onclick="buttonClick(showTeamStats)">–ö–æ–º–∞–Ω–¥—ã</button>
                    <button class="btn btn-active" onclick="buttonClick(showPlayerStats)">–ò–≥—Ä–æ–∫–∏</button>
                </div>
                
                <!-- –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä–æ–∫–æ–≤ -->
                <div class="stats-table-container">
                    <table class="stats-table" id="playerStatsTable">
                        <thead>
                            <tr>
                                <th>–ò–≥—Ä–æ–∫</th>
                                <th>–û—á–∫–∏</th>
                            </tr>
                        </thead>
                        <tbody id="playerStatsBody">
                        </tbody>
                    </table>
                </div>
                
                <button class="btn" onclick="buttonClick(newGame)">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </div>
    </div>

    <script>
        let ws;
        let gameState = {};
        let gameSetup = {
            players: [],
            teams: [],
            roundDuration: 30,
            wordsCount: 100
        };

        // –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
        let audioContext;
        let soundEnabled = false;
        let audioUnlocked = false;
        
        // –ê—É–¥–∏–æ—Ñ–∞–π–ª—ã
        let audioFiles = {
            warning5s: null,
            next: null,
            done: null,
            click: null,
            start: null,
            finish: null
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('–ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É–¥–∏–æ:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
        function loadAudioFiles() {
            console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤...');
            
            // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã Audio –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–≤—É–∫–∞ (–∏–∑ –ø–∞–ø–∫–∏ /Sound)
            audioFiles.done = new Audio('/Sound/done.mp3');
            audioFiles.next = new Audio('/Sound/next.mp3');
            audioFiles.click = new Audio('/Sound/click.mp3');
            audioFiles.start = new Audio('/Sound/start.mp3');
            audioFiles.finish = new Audio('/Sound/finish.mp3');
            audioFiles.warning5s = new Audio('/Sound/5timer2.mp3');

            // –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–µ —Ñ–∞–π–ª—ã –∑–≤—É–∫–æ–≤
            
            // –ü—Ä–µ–ª–æ–∞–¥ –∏ –≥—Ä–æ–º–∫–æ—Å—Ç—å
            Object.values(audioFiles).forEach(audio => {
                if (audio && typeof audio.preload !== 'undefined') {
                    audio.preload = 'auto';
                    audio.volume = 0.6;
                }
            });
            
            console.log('–ê—É–¥–∏–æ—Ñ–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
        function playAudioFile(audioFile, volume = 0.5) {
            if (!soundEnabled || !audioUnlocked || !audioFile) return;
            
            try {
                audioFile.volume = volume;
                audioFile.currentTime = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –Ω–∞—á–∞–ª–æ
                audioFile.play().catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:', error);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞:', error);
            }
        }

        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è)
        function unlockAudio() {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume().then(() => {
                    console.log('–ê—É–¥–∏–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ');
                    audioUnlocked = true;
                });
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∑–≤—É–∫–∞
        function createTone(frequency, duration, type = 'sine', volume = 0.3) {
            if (!audioContext || !audioUnlocked) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = type;

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ —Å –ø–ª–∞–≤–Ω—ã–º –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —à—É—Ä—à–∞—â–µ–≥–æ –∑–≤—É–∫–∞ (–±–µ–ª—ã–π —à—É–º —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π)
        function createRustleSound(duration = 0.4, volume = 0.3) {
            if (!audioContext || !audioUnlocked) return;

            // –°–æ–∑–¥–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –±–µ–ª–æ–≥–æ —à—É–º–∞
            const bufferSize = audioContext.sampleRate * duration;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–µ–ª—ã–π —à—É–º
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }

            const whiteNoise = audioContext.createBufferSource();
            whiteNoise.buffer = buffer;

            // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —à—É—Ä—à–∞–Ω–∏—è
            const filter = audioContext.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(800, audioContext.currentTime);
            filter.Q.setValueAtTime(1, audioContext.currentTime);

            // –°–æ–∑–¥–∞–µ–º –º–æ–¥—É–ª—è—Ü–∏—é —á–∞—Å—Ç–æ—Ç—ã –¥–ª—è –±–æ–ª–µ–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∑–≤—É–∫–∞
            const lfo = audioContext.createOscillator();
            const lfoGain = audioContext.createGain();
            lfo.frequency.setValueAtTime(15, audioContext.currentTime);
            lfoGain.gain.setValueAtTime(200, audioContext.currentTime);
            lfo.connect(lfoGain);
            lfoGain.connect(filter.frequency);

            // –°–æ–∑–¥–∞–µ–º —É–∑–µ–ª –≥—Ä–æ–º–∫–æ—Å—Ç–∏ —Å –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º
            const gainNode = audioContext.createGain();
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É: –±–µ–ª—ã–π —à—É–º -> —Ñ–∏–ª—å—Ç—Ä -> –≥—Ä–æ–º–∫–æ—Å—Ç—å -> –≤—ã—Ö–æ–¥
            whiteNoise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫
            whiteNoise.start(audioContext.currentTime);
            lfo.start(audioContext.currentTime);
            whiteNoise.stop(audioContext.currentTime + duration);
            lfo.stop(audioContext.currentTime + duration);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∑–≤—É–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ Windows (–¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–µ—Ä–Ω–æ")
        function createDeviceConnectSound(duration = 0.6, volume = 0.5) {
            if (!audioContext || !audioUnlocked) return;

            // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–Ω - –≤–æ—Å—Ö–æ–¥—è—â–∞—è –º–µ–ª–æ–¥–∏—è (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∞—è –¥–ª—è Windows)
            const mainOscillator = audioContext.createOscillator();
            const mainGain = audioContext.createGain();
            
            // –°–æ–∑–¥–∞–µ–º –º–µ–ª–æ–¥–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –¥–æ-–º–∏-—Å–æ–ª—å (–º–∞–∂–æ—Ä–Ω–æ–µ —Ç—Ä–µ–∑–≤—É—á–∏–µ)
            const frequencies = [261.63, 329.63, 392.00]; // C4, E4, G4
            const noteDuration = duration / 3;
            
            mainOscillator.frequency.setValueAtTime(frequencies[0], audioContext.currentTime);
            mainOscillator.frequency.setValueAtTime(frequencies[1], audioContext.currentTime + noteDuration);
            mainOscillator.frequency.setValueAtTime(frequencies[2], audioContext.currentTime + noteDuration * 2);
            mainOscillator.type = 'sine';

            // –°–æ–∑–¥–∞–µ–º –≥–∞—Ä–º–æ–Ω–∏–∫–∏ –¥–ª—è –±–æ–ª–µ–µ –±–æ–≥–∞—Ç–æ–≥–æ –∑–≤—É—á–∞–Ω–∏—è
            const harmonic1 = audioContext.createOscillator();
            const harmonic2 = audioContext.createOscillator();
            const harmonicGain = audioContext.createGain();
            
            harmonic1.frequency.setValueAtTime(frequencies[0] * 2, audioContext.currentTime);
            harmonic1.frequency.setValueAtTime(frequencies[1] * 2, audioContext.currentTime + noteDuration);
            harmonic1.frequency.setValueAtTime(frequencies[2] * 2, audioContext.currentTime + noteDuration * 2);
            harmonic1.type = 'sine';
            
            harmonic2.frequency.setValueAtTime(frequencies[0] * 3, audioContext.currentTime);
            harmonic2.frequency.setValueAtTime(frequencies[1] * 3, audioContext.currentTime + noteDuration);
            harmonic2.frequency.setValueAtTime(frequencies[2] * 3, audioContext.currentTime + noteDuration * 2);
            harmonic2.type = 'sine';

            // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –ø—Ä–∏–¥–∞–Ω–∏—è "—Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ" –∑–≤—É—á–∞–Ω–∏—è Windows
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(2000, audioContext.currentTime);
            filter.Q.setValueAtTime(1, audioContext.currentTime);

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–º –¥–ª—è Windows ADSR
            mainGain.gain.setValueAtTime(0, audioContext.currentTime);
            mainGain.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.02); // Attack
            mainGain.gain.setValueAtTime(volume * 0.8, audioContext.currentTime + duration * 0.8); // Sustain
            mainGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration); // Release
            
            harmonicGain.gain.setValueAtTime(0, audioContext.currentTime);
            harmonicGain.gain.linearRampToValueAtTime(volume * 0.3, audioContext.currentTime + 0.02);
            harmonicGain.gain.setValueAtTime(volume * 0.2, audioContext.currentTime + duration * 0.8);
            harmonicGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É
            mainOscillator.connect(filter);
            harmonic1.connect(harmonicGain);
            harmonic2.connect(harmonicGain);
            filter.connect(mainGain);
            mainGain.connect(audioContext.destination);
            harmonicGain.connect(audioContext.destination);

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫–∏
            mainOscillator.start(audioContext.currentTime);
            harmonic1.start(audioContext.currentTime);
            harmonic2.start(audioContext.currentTime);
            mainOscillator.stop(audioContext.currentTime + duration);
            harmonic1.stop(audioContext.currentTime + duration);
            harmonic2.stop(audioContext.currentTime + duration);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–≥–æ –∑–≤—É–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ Windows (–¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–ø—É—Å–∫")
        function createDeviceDisconnectSound(duration = 0.4, volume = 0.5) {
            if (!audioContext || !audioUnlocked) return;

            // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–Ω - –Ω–∏—Å—Ö–æ–¥—è—â–∞—è –º–µ–ª–æ–¥–∏—è (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–∞—è –¥–ª—è Windows –æ—Ç–∫–ª—é—á–µ–Ω–∏—è)
            const mainOscillator = audioContext.createOscillator();
            const mainGain = audioContext.createGain();
            
            // –°–æ–∑–¥–∞–µ–º –º–µ–ª–æ–¥–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: —Å–æ–ª—å-–º–∏-–¥–æ (–Ω–∏—Å—Ö–æ–¥—è—â–µ–µ —Ç—Ä–µ–∑–≤—É—á–∏–µ)
            const frequencies = [392.00, 329.63, 261.63]; // G4, E4, C4
            const noteDuration = duration / 3;
            
            mainOscillator.frequency.setValueAtTime(frequencies[0], audioContext.currentTime);
            mainOscillator.frequency.setValueAtTime(frequencies[1], audioContext.currentTime + noteDuration);
            mainOscillator.frequency.setValueAtTime(frequencies[2], audioContext.currentTime + noteDuration * 2);
            mainOscillator.type = 'sine';

            // –°–æ–∑–¥–∞–µ–º –¥–∏—Å—Å–æ–Ω–∞–Ω—Å–Ω—ã–π —Ç–æ–Ω –¥–ª—è "–æ—Ç–∫–ª—é—á–µ–Ω–∏—è"
            const dissonanceOscillator = audioContext.createOscillator();
            const dissonanceGain = audioContext.createGain();
            
            // –î–∏—Å—Å–æ–Ω–∞–Ω—Å–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ (–º–∞–ª–∞—è —Å–µ–∫—É–Ω–¥–∞)
            dissonanceOscillator.frequency.setValueAtTime(415.30, audioContext.currentTime); // G#4
            dissonanceOscillator.frequency.setValueAtTime(349.23, audioContext.currentTime + noteDuration); // F4
            dissonanceOscillator.frequency.setValueAtTime(277.18, audioContext.currentTime + noteDuration * 2); // C#4
            dissonanceOscillator.type = 'sawtooth';

            // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä —Å –±–æ–ª–µ–µ —Ä–µ–∑–∫–∏–º –∑–≤—É—á–∞–Ω–∏–µ–º
            const filter = audioContext.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1500, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + duration);
            filter.Q.setValueAtTime(2, audioContext.currentTime);

            // –°–æ–∑–¥–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π "—â–µ–ª—á–æ–∫" –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
            const clickOscillator = audioContext.createOscillator();
            const clickGain = audioContext.createGain();
            clickOscillator.frequency.setValueAtTime(2000, audioContext.currentTime);
            clickOscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + duration * 0.3);
            clickOscillator.type = 'square';

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ —Å —Ä–µ–∑–∫–∏–º –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º (—Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è)
            mainGain.gain.setValueAtTime(0, audioContext.currentTime);
            mainGain.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
            mainGain.gain.setValueAtTime(volume * 0.6, audioContext.currentTime + duration * 0.5);
            mainGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            dissonanceGain.gain.setValueAtTime(0, audioContext.currentTime);
            dissonanceGain.gain.linearRampToValueAtTime(volume * 0.4, audioContext.currentTime + 0.01);
            dissonanceGain.gain.setValueAtTime(volume * 0.2, audioContext.currentTime + duration * 0.5);
            dissonanceGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
            
            clickGain.gain.setValueAtTime(0, audioContext.currentTime);
            clickGain.gain.linearRampToValueAtTime(volume * 0.3, audioContext.currentTime + 0.005);
            clickGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration * 0.3);

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ü–µ–ø–æ—á–∫–∏
            mainOscillator.connect(filter);
            dissonanceOscillator.connect(dissonanceGain);
            clickOscillator.connect(clickGain);
            filter.connect(mainGain);
            mainGain.connect(audioContext.destination);
            dissonanceGain.connect(audioContext.destination);
            clickGain.connect(audioContext.destination);

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫–∏
            mainOscillator.start(audioContext.currentTime);
            dissonanceOscillator.start(audioContext.currentTime);
            clickOscillator.start(audioContext.currentTime);
            mainOscillator.stop(audioContext.currentTime + duration);
            dissonanceOscillator.stop(audioContext.currentTime + duration);
            clickOscillator.stop(audioContext.currentTime + duration * 0.3);
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–≤—É–∫ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–±–æ–ª–µ–µ —Ä–µ–∑–∫–∏–π)
        function createUSBDisconnectSound(duration = 0.2, volume = 0.4) {
            if (!audioContext || !audioUnlocked) return;

            // –°–æ–∑–¥–∞–µ–º –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä —Å –±—ã—Å—Ç—Ä—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            // –†–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã (–∏–º–∏—Ç–∞—Ü–∏—è "–æ—Ç–∫–ª—é—á–µ–Ω–∏—è")
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + duration * 0.3);
            oscillator.frequency.setValueAtTime(100, audioContext.currentTime + duration * 0.3);
            oscillator.type = 'sawtooth';

            // –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –¥–ª—è "—Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ" –∑–≤—É—á–∞–Ω–∏—è
            const filter = audioContext.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(1500, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(300, audioContext.currentTime + duration);
            filter.Q.setValueAtTime(2, audioContext.currentTime);

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.005);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ü–µ–ø–æ—á–∫—É
            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–≤—É–∫
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // –ó–≤—É–∫–∏ –∏–≥—Ä—ã
        const sounds = {
            // –°—Ç–∞—Ä—Ç —Ö–æ–¥–∞
            startTurn: () => {
                playAudioFile(audioFiles.start, 0.8);
            },

            // –û–∫–æ–Ω—á–∞–Ω–∏–µ —Ö–æ–¥–∞/—Ä–∞—É–Ω–¥–∞
            endTurn: () => {
                playAudioFile(audioFiles.finish, 0.8);
            },

            

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
            warning5s: () => {
                playAudioFile(audioFiles.warning5s, 0.8);
            },

            // –ö–ª–∏–∫ –∫–Ω–æ–ø–∫–∏ (–ø—Ä–æ—á–∏–µ –∫–Ω–æ–ø–∫–∏)
            buttonClick: () => {
                playAudioFile(audioFiles.click, 0.5);
            },

            // –£–≥–∞–¥–∞–Ω–æ —Å–ª–æ–≤–æ - "done"
            wordGuessed: () => {
                playAudioFile(audioFiles.done, 0.8);
            },

            // –ü—Ä–æ–ø—É—Å–∫ —Å–ª–æ–≤–∞ - "next"
            wordPassed: () => {
                playAudioFile(audioFiles.next, 0.8);
            }
        };

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function playSound(soundName) {
            if (!soundEnabled || !audioUnlocked) return;
            
            try {
                if (sounds[soundName]) {
                    sounds[soundName]();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:', error);
            }
        }

        // –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function toggleSound() {
            soundEnabled = !soundEnabled;
            if (soundEnabled && !audioUnlocked) {
                unlockAudio();
            }
            console.log('–ó–≤—É–∫', soundEnabled ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω');
            return soundEnabled;
        }

        // –í–∫–ª—é—á–µ–Ω–∏–µ –∞—É–¥–∏–æ —Å —ç–∫—Ä–∞–Ω–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        function enableAudio() {
            initAudio();
            loadAudioFiles();
            unlockAudio();
            soundEnabled = true;
            audioUnlocked = true;
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤—É–∫
            setTimeout(() => {
                playSound('buttonClick');
            }, 100);
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç–∫—Ä–∞–Ω—É –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
            showScreen('setupScreen');
        }

        // –ü—Ä–æ–ø—É—Å–∫ –∞—É–¥–∏–æ
        function skipAudio() {
            soundEnabled = false;
            showScreen('setupScreen');
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å –∑–≤—É–∫–æ–º
        function buttonClick(callback) {
            playSound('buttonClick');
            if (callback) callback();
        }

        // –£–¥–∞–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—ã–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–≤—É–∫–∏

        // –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ç–∞–π–º–µ—Ä —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º performance.now()
        let timerState = {
            isRunning: false,
            isPaused: false,
            startTime: null,
            duration: 30000, // 30 —Å–µ–∫—É–Ω–¥ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
            remainingTime: 30000,
            animationFrameId: null,
            carriedTime: 0, // –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É —Ä–∞—É–Ω–¥–∞–º–∏
            roundStartTime: null, // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
            pausedDuration: 0, // –û–±—â–µ–µ –≤—Ä–µ–º—è –ø–∞—É–∑ –≤ —Ä–∞—É–Ω–¥–µ
            pauseStartTime: null, // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ç–µ–∫—É—â–µ–π –ø–∞—É–∑—ã
            roundEndProcessed: false, // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞
            warningPlayed: false // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
        };

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω');
                updateConnectionStatus(true);
            };
            
            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);
                console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ:', message);
                console.log('–¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è:', message.type);
                
                if (message.type === 'game_state') {
                    gameState = message.data;
                    console.log('–ü–æ–ª—É—á–µ–Ω game_state —Å playerCarriedTime:', gameState.playerCarriedTime);
                    updateGameDisplay();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
                    const isOnRulesScreen = document.getElementById('rulesScreen2').classList.contains('active') || 
                                          document.getElementById('rulesScreen3').classList.contains('active');
                    const isOnRoundScoresScreen = document.getElementById('roundScoresScreen').classList.contains('active');
                    
                    if (isOnRulesScreen || isOnRoundScoresScreen) {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
                        showPlayerIntroScreen();
                    } else if (document.getElementById('gameScreen').classList.contains('active') && !timerState.isRunning) {
                        // –ï—Å–ª–∏ –º—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∏–≥—Ä—ã –∏ —Ç–∞–π–º–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ —Å —É—á–µ—Ç–æ–º carriedTime
                        const currentPlayerCarriedTime = gameState.playerCarriedTime && gameState.currentPlayer 
                            ? (gameState.playerCarriedTime[gameState.currentPlayer.id] || 0)
                            : 0;
                        
                        console.log('–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è game_state:');
                        console.log('- currentPlayer:', gameState.currentPlayer);
                        console.log('- currentPlayerCarriedTime:', currentPlayerCarriedTime);
                        
                        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
                        // –ï—Å–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è > 0, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ –ø–æ–ª–Ω–æ–µ –≤—Ä–µ–º—è —Ç–∞–π–º–µ—Ä–∞
                        // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞
                        const timerDuration = currentPlayerCarriedTime > 0 ? currentPlayerCarriedTime : gameSetup.roundDuration;
                        startTimer(timerDuration, currentPlayerCarriedTime);
                    }
                } else if (message.type === 'round_completed') {
                    console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ round_completed:', message.data);
                    // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º currentRound –∑–¥–µ—Å—å - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º game_state
                    // message.data.currentRound —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (1, 2, 3)
                    gameState.scores = message.data.scores;
                    
                    // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç —Ä–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ø–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—é —Å–ª–æ–≤
                    // –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
                    if (timerState.isRunning) {
                        endRoundByWordsExhausted();
                    }
                    // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è —É–∂–µ –≤—ã—á–∏—Å–ª–µ–Ω–æ
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞
                    // message.data.currentRound —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–æ–º–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞ (1, 2, 3)
                    const completedRound = message.data.currentRound;
                    
                    if (completedRound === 1) {
                        // –ó–∞–≤–µ—Ä—à–∏–ª—Å—è –ø–µ—Ä–≤—ã–π —Ä–∞—É–Ω–¥ - —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª 2-–≥–æ —Ä–∞—É–Ω–¥–∞
                        showScreen('rulesScreen2');
                    } else if (completedRound === 2) {
                        // –ó–∞–≤–µ—Ä—à–∏–ª—Å—è –≤—Ç–æ—Ä–æ–π —Ä–∞—É–Ω–¥ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª 3-–≥–æ —Ä–∞—É–Ω–¥–∞
                        showScreen('rulesScreen3');
                    } else if (completedRound === 3) {
                        // –ó–∞–≤–µ—Ä—à–∏–ª—Å—è —Ç—Ä–µ—Ç–∏–π —Ä–∞—É–Ω–¥ - –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                        showResults();
                    }
                } else if (message.type === 'game_ended') {
                    console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ game_ended:', message.data);
                    console.log('–°—á–µ—Ç–∞ –∫–æ–º–∞–Ω–¥ –≤ game_ended:', message.data.scores);
                    console.log('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞—É–Ω–¥–∞–º –≤ game_ended:', message.data.teamStatsByRound);
                    gameState = message.data;
                    showResults();
                } else if (message.type === 'handoff_screen') {
                    console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ handoff_screen:', message.data);
                    showHandoffScreen(message.data);
                } else if (message.type === 'error') {
                    alert('–û—à–∏–±–∫–∞: ' + message.message);
                }
            };
            
            ws.onclose = function() {
                console.log('WebSocket –æ—Ç–∫–ª—é—á–µ–Ω');
                updateConnectionStatus(false);
                // –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(connectWebSocket, 3000);
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
                updateConnectionStatus(false);
            };
        }

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
                status.className = 'connection-status connected';
            } else {
                status.textContent = '–û—Ç–∫–ª—é—á–µ–Ω–æ';
                status.className = 'connection-status disconnected';
            }
        }

        function sendEvent(type, data = {}) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type, data }));
            } else {
                console.error('WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
            }
        }

        function setupTeams() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const teamCount = parseInt(document.getElementById('teamCount').value);
            const roundDuration = parseInt(document.getElementById('roundDuration').value);
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
            if (playerCount < 4 || playerCount > 20) {
                alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 4 –¥–æ 20.');
                return;
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–æ–º–∞–Ω–¥
            const players = [];
            const teams = [];
            
            for (let i = 1; i <= playerCount; i++) {
                players.push({
                    id: `player_${i}`,
                    name: `–ò–≥—Ä–æ–∫ ${i}`
                });
            }
            
            for (let i = 1; i <= teamCount; i++) {
                teams.push({
                    id: `team_${i}`,
                    name: `–ö–æ–º–∞–Ω–¥–∞ ${i}`,
                    players: []
                });
            }
            
            // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
            players.forEach((player, index) => {
                const teamIndex = index % teamCount;
                teams[teamIndex].players.push(player.id);
            });
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            gameSetup.players = players;
            gameSetup.teams = teams;
            gameSetup.roundDuration = roundDuration;
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
            displayTeams();
            showScreen('teamsScreen');
        }

        function displayTeams() {
            const teamsList = document.getElementById('teamsList');
            teamsList.innerHTML = '';
            
            gameSetup.teams.forEach(team => {
                const teamDiv = document.createElement('div');
                teamDiv.className = 'team-item';
                
                const playersHtml = team.players.map(playerId => {
                    const player = gameSetup.players.find(p => p.id === playerId);
                    return `<span class="player-tag">${player.name}</span>`;
                }).join('');
                
                teamDiv.innerHTML = `
                    <h3>${team.name}</h3>
                    <div class="team-players">${playersHtml}</div>
                `;
                
                teamsList.appendChild(teamDiv);
            });
        }

        function shuffleTeams() {
            const playerCount = gameSetup.players.length;
            const teamCount = gameSetup.teams.length;
            
            // –û—á–∏—Å—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
            gameSetup.teams.forEach(team => {
                team.players = [];
            });
            
            // –°–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
            const shuffledPlayers = [...gameSetup.players].sort(() => Math.random() - 0.5);
            
            shuffledPlayers.forEach((player, index) => {
                const teamIndex = index % teamCount;
                gameSetup.teams[teamIndex].players.push(player.id);
            });
            
            displayTeams();
        }

        function setupWords() {
            showScreen('wordsScreen');
        }

        

        const ALL_CATEGORIES = [
            '–§–ª–æ—Ä–∞ –∏ —Ñ–∞—É–Ω–∞',
            '–ó–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–∏',
            '–ü—Ä–∏—Ä–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è',
            '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è',
            '–¢–µ—Ö–Ω–∏–∫–∞',
            '–í–µ—â–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç—ã –±—ã—Ç–∞',
            '–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è',
            '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –≤–µ—â–µ—Å—Ç–≤–∞',
            '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è –∏ —Ö–æ–±–±–∏',
            '–°–ø–æ—Ä—Ç –∏ —Ñ–∏—Ç–Ω–µ—Å',
            '–ü—Ä–æ—Ñ–µ—Å—Å–∏–∏ –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏',
            '–û–±—â–µ—Å—Ç–≤–æ –∏ –±—é—Ä–æ–∫—Ä–∞—Ç–∏—è',
            '–ó–¥–æ—Ä–æ–≤—å–µ –∏ –º–µ–¥–∏—Ü–∏–Ω–∞',
            '–ü—Ä–∞–∑–¥–Ω–∏–∫–∏, –æ–±—ã—á–∞–∏ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–∏',
            '–¶–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã',
            '–§–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã',
            '–ö–Ω–∏–≥–∏ –∏ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞',
            '–§—Ä–∞–∑–µ–æ–ª–æ–≥–∏–∑–º—ã, –ø–æ—Å–ª–æ–≤–∏—Ü—ã –∏ –ø–æ–≥–æ–≤–æ—Ä–∫–∏',
            '–ò—Å—Ç–æ—Ä–∏—è',
            '–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –≥–æ—Ä–æ–¥—Å–∫–∞—è —Å—Ä–µ–¥–∞',
            '–ë—Ä–µ–Ω–¥—ã –∏ —Ç–æ—Ä–≥–æ–≤—ã–µ –º–∞—Ä–∫–∏',
            '–ú—É–∑—ã–∫–∞',
            '–≠–º–æ—Ü–∏–∏ –∏ —á–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞',
            '–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'
        ];

        function renderCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';
            ALL_CATEGORIES.forEach((cat, idx) => {
                const id = `cat_${idx}`;
                const item = document.createElement('label');
                item.style.display = 'flex';
                item.style.alignItems = 'center';
                item.style.gap = '12px';
                item.style.padding = '12px 14px';
                item.style.border = '1px solid rgba(255,255,255,0.18)';
                item.style.borderRadius = '12px';
                item.style.background = 'rgba(255,255,255,0.06)';
                item.style.backdropFilter = 'blur(2px)';
                item.style.minHeight = '52px';
                item.style.justifyContent = 'flex-start';
                item.innerHTML = `
                    <input type="checkbox" class="categoryBox" id="${id}" data-category="${cat}" checked style="width:26px;height:26px; accent-color:#ffeb3b;"> 
                    <span style="font-size:16px; line-height: 1.2;">${cat}</span>
                `;
                container.appendChild(item);
            });
        }

        function selectAllCategories(val) {
            document.querySelectorAll('#categoriesContainer .categoryBox').forEach(cb => {
                cb.checked = !!val;
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —ç–∫—Ä–∞–Ω–∞ —Å–ª–æ–≤
        const wordsScreenObserver = new MutationObserver(() => {
            const screen = document.getElementById('wordsScreen');
            if (screen && screen.style.display !== 'none') {
                renderCategories();
                initDifficultyControls();
                wordsScreenObserver.disconnect();
            }
        });
        wordsScreenObserver.observe(document.body, { childList: true, subtree: true });

        // –ö—ç—à –¥–ª—è —Å–ª–æ–≤ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        let elevatedWordsCache = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–ª–æ–≤–æ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function isWordElevated(word) {
            if (!word) return false;
            
            // –ï—Å–ª–∏ –∫—ç—à –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
            if (elevatedWordsCache === null) {
                loadElevatedWordsCache();
            }
            
            return elevatedWordsCache && elevatedWordsCache.has(word.toUpperCase());
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫—ç—à–∞ —Å–ª–æ–≤ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function loadElevatedWordsCache() {
            fetch('/words.csv')
                .then(response => response.text())
                .then(csvText => {
                    const lines = csvText.split('\n');
                    elevatedWordsCache = new Set();
                    
                    lines.forEach(line => {
                        const parts = line.split(',');
                        if (parts.length >= 3 && parts[2].trim() === '–ø–æ–≤—ã—à–µ–Ω–Ω—ã–π') {
                            elevatedWordsCache.add(parts[0].trim().toUpperCase());
                        }
                    });
                    
                    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å–ª–æ–≤ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:', elevatedWordsCache.size);
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ words.csv:', error);
                    elevatedWordsCache = new Set();
                });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—É–º–±–ª–µ—Ä–∞ –∏ —Å–ª–∞–π–¥–µ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function initDifficultyControls() {
            const toggle = document.getElementById('difficultyToggle');
            const knob = document.getElementById('difficultyKnob');
            const slider = document.getElementById('difficultySlider');
            const sliderValue = document.getElementById('difficultySliderValue');
            
            if (!toggle || !knob || !slider || !sliderValue) return;

            const applyState = () => {
                const bg = toggle.checked ? '#2196F3' : '#666';
                knob.style.transform = toggle.checked ? 'translateX(26px)' : 'translateX(0)';
                knob.previousElementSibling.style.backgroundColor = bg;
                
                // –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ–º –º–∏–Ω–∏–º—É–º 25%, –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ ‚Äî 0 –∏ –¥–∏–∑–µ–π–±–ª–∏–º
                if (toggle.checked) {
                    if (parseInt(slider.value, 10) === 0) {
                        slider.value = '25';
                    }
                    slider.disabled = false;
                } else {
                    slider.value = '0';
                    slider.disabled = true;
                }
                sliderValue.textContent = `${slider.value}%`;
            };

            // –í—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä—Ç—É–µ–º —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ –∫–∞–∂–¥–æ–º –ø–æ–∫–∞–∑–µ —ç–∫—Ä–∞–Ω–∞
            toggle.checked = true;
            slider.value = '25';

            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            toggle.removeEventListener('change', applyState);
            slider.removeEventListener('input', handleSliderInput);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            toggle.addEventListener('change', applyState);
            slider.addEventListener('input', handleSliderInput);

            function handleSliderInput() {
                const v = Math.max(0, Math.min(100, Math.round(parseInt(slider.value, 10) / 5) * 5));
                slider.value = String(v);
                sliderValue.textContent = `${slider.value}%`;
                // –ê–≤—Ç–æ–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —Ç—É–º–±–ª–µ—Ä–∞ –ø—Ä–∏ 0%
                if (v === 0 && toggle.checked) {
                    toggle.checked = false;
                    applyState();
                } else if (v > 0 && !toggle.checked) {
                    toggle.checked = true;
                    applyState();
                }
            }

            applyState();
        }

        function getSelectedCategories() {
            const list = [];
            document.querySelectorAll('#categoriesContainer .categoryBox:checked').forEach(cb => list.push(cb.getAttribute('data-category')));
            return list;
        }

        function getSelectedLevels() {
            const toggle = document.getElementById('difficultyToggle');
            if (!toggle) return ['–æ–±—ã—á–Ω—ã–π', '–ø–æ–≤—ã—à–µ–Ω–Ω—ã–π'];
            return toggle.checked ? ['–æ–±—ã—á–Ω—ã–π', '–ø–æ–≤—ã—à–µ–Ω–Ω—ã–π'] : ['–æ–±—ã—á–Ω—ã–π'];
        }

        function startGame() {
            const wordsCount = parseInt(document.getElementById('wordsCount').value);
            gameSetup.wordsCount = wordsCount;
            const selectedCategories = getSelectedCategories();
            const selectedLevels = getSelectedLevels();
            const slider = document.getElementById('difficultySlider');
            const hardPercentage = slider ? Math.max(0, Math.min(100, parseInt(slider.value, 10) || 0)) : 0;
            
            // –û—á–∏—â–∞–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
            clearCarriedTime();
            
            
            
            sendEvent('start_game', {
                players: gameSetup.players,
                teams: gameSetup.teams,
                roundDuration: gameSetup.roundDuration,
                wordsCount: gameSetup.wordsCount,
                categories: selectedCategories.length ? selectedCategories : undefined,
                levels: selectedLevels.length ? selectedLevels : undefined,
                hardPercentage: hardPercentage
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∏–≥—Ä–µ
            showScreen('rulesScreen1');
            // –ù–∞ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Å–Ω—è—Ç–∏–µ –ª—é–±–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
            toggleButtonsDuringPause(false);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –ø—Ä–∞–≤–∏–ª
        function startFirstRound() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞
            showPlayerIntroScreen();
        }

        function startSecondRound() {
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
            sendEvent('continue_round');
            console.log('startSecondRound - –∂–¥–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è game_state –¥–ª—è –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞');
            // –≠–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ game_state
        }

        function startThirdRound() {
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É
            sendEvent('continue_round');
            console.log('startThirdRound - –∂–¥–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è game_state –¥–ª—è –ø–æ–∫–∞–∑–∞ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞');
            // –≠–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ game_state
        }


        function wordGuessed() {
            const currentTeam = getCurrentTeam();
            if (currentTeam) {
                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —É–≥–∞–¥—ã–≤–∞–Ω–∏—è
                playSound('wordGuessed');
                sendEvent('word_guessed', { teamId: currentTeam.id });
            }
        }

        function wordPassed() {
            const currentTeam = getCurrentTeam();
            if (currentTeam) {
                // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø—Ä–æ–ø—É—Å–∫–∞
                playSound('wordPassed');
                sendEvent('word_passed', { teamId: currentTeam.id });
            }
        }

        function pauseGame() {
            const pauseBtn = document.getElementById('pauseBtn');
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏
            playSound('buttonClick');
            
            if (timerState.isPaused) {
                sendEvent('resume_game');
                pauseBtn.textContent = '‚è∏Ô∏è';
                resumeTimer();
                toggleButtonsDuringPause(false);
            } else {
                sendEvent('pause_game');
                pauseBtn.textContent = '‚ñ∂Ô∏è';
                pauseTimer();
                toggleButtonsDuringPause(true);
            }
        }

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤–æ –≤—Ä–µ–º—è –ø–∞—É–∑—ã, –∫—Ä–æ–º–µ –ø–∞—É–∑—ã –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
        function toggleButtonsDuringPause(isPaused) {
            try {
                const allButtons = document.querySelectorAll('button');
                allButtons.forEach((btn) => {
                    const isPauseButton = btn.id === 'pauseBtn';
                    const isEndButton = btn.classList && btn.classList.contains('end-btn');
                    if (isPauseButton || isEndButton) {
                        btn.disabled = false;
                    } else {
                        btn.disabled = !!isPaused;
                    }
                });
            } catch (e) {
                console.warn('toggleButtonsDuringPause error:', e);
            }
        }

        function endGame() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É?')) {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
                stopTimer();
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
                resetTimer();
                // –°–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã
                toggleButtonsDuringPause(false);
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–≥—Ä—ã
                showScreen('setupScreen');
            }
        }

        function newGame() {
            showScreen('setupScreen');
            stopTimer();
            // –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–≥—Ä—ã
            gameSetup = {
                players: [],
                teams: [],
                roundDuration: 30,
                wordsCount: 100
            };
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
            resetTimer();
            // –°–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
            toggleButtonsDuringPause(false);
        }

        function getCurrentTeam() {
            if (!gameState.teams || !gameState.currentPlayer) return null;
            
            for (const team of gameState.teams) {
                if (team.players && team.players.includes(gameState.currentPlayer.id)) {
                    return team;
                }
            }
            return null;
        }

        function updateGameDisplay() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞—É–Ω–¥–µ
            const roundInfo = document.getElementById('roundInfo');
            if (gameState.currentRound !== undefined) {
                console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞:', gameState.currentRound, '–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫:', gameState.currentRound + 1);
                roundInfo.textContent = `–¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥: ${gameState.currentRound + 1} –∏–∑ 3`;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–≥—Ä–æ–∫–µ
            const playerInfo = document.getElementById('playerInfo');
            if (gameState.currentPlayer) {
                // –ù–∞—Ö–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –∏–≥—Ä–æ–∫–∞
                const playerTeam = gameState.teams.find(team => 
                    team.players && team.players.includes(gameState.currentPlayer.id)
                );
                
                if (playerTeam) {
                    playerInfo.textContent = `–•–æ–¥: ${gameState.currentPlayer.name} (${playerTeam.name})`;
                } else {
                    playerInfo.textContent = `–•–æ–¥: ${gameState.currentPlayer.name}`;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Å–ª–æ–≤
            const wordsCounter = document.getElementById('wordsCounter');
            if (gameState.availableWords !== undefined) {
                // –û—Ç–Ω–∏–º–∞–µ–º –µ–¥–∏–Ω–∏—Ü—É, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–∫—É—â–µ–µ —Å–ª–æ–≤–æ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω–æ
                const wordsLeft = Math.max(0, gameState.availableWords.length - 1);
                wordsCounter.textContent = `–ï—â–µ —Å–ª–æ–≤ - ${wordsLeft}`;
                
                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤
                if (wordsLeft <= 10) {
                    wordsCounter.style.color = '#ff6b6b'; // –ö—Ä–∞—Å–Ω—ã–π –∫–æ–≥–¥–∞ –º–∞–ª–æ —Å–ª–æ–≤
                } else if (wordsLeft <= 25) {
                    wordsCounter.style.color = '#ff9800'; // –û—Ä–∞–Ω–∂–µ–≤—ã–π –∫–æ–≥–¥–∞ —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                } else {
                    wordsCounter.style.color = '#ffeb3b'; // –ñ–µ–ª—Ç—ã–π –∫–æ–≥–¥–∞ –º–Ω–æ–≥–æ —Å–ª–æ–≤
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ–≤–∞
            const currentWord = document.getElementById('currentWord');
            if (gameState.currentWord) {
                currentWord.textContent = gameState.currentWord;
                // Debug-–ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª–æ–≤ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                if (window.__hatDebug && window.__hatDebug.highlightElevated) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑ gameState –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
                    const isElevated = gameState.currentWordLevel === '–ø–æ–≤—ã—à–µ–Ω–Ω—ã–π' || 
                                     (gameState.currentWord && isWordElevated(gameState.currentWord));
                    if (isElevated) {
                        currentWord.style.color = '#000000';
                        currentWord.style.backgroundColor = '#ffff00'; // –ñ–µ–ª—Ç—ã–π —Ñ–æ–Ω –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏
                    } else {
                        currentWord.style.color = '';
                        currentWord.style.backgroundColor = '';
                    }
                } else {
                    currentWord.style.color = '';
                    currentWord.style.backgroundColor = '';
                }
            } else {
                currentWord.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
                currentWord.style.color = '';
                currentWord.style.backgroundColor = '';
            }

        }

        function updateScores() {
            const scoresContainer = document.getElementById('scores');
            scoresContainer.innerHTML = '';
            
            if (gameState.teams && gameState.scores) {
                gameState.teams.forEach(team => {
                    const scoreDiv = document.createElement('div');
                    scoreDiv.className = 'score-item';
                    scoreDiv.innerHTML = `
                        <h3>${team.name}</h3>
                        <div class="score">${gameState.scores[team.id] || 0}</div>
                    `;
                    scoresContainer.appendChild(scoreDiv);
                });
            }
        }

        function showRoundScores() {
            const roundScores = document.getElementById('roundScores');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥
            roundScores.innerHTML = '';
            if (gameState.teams && gameState.scores) {
                gameState.teams.forEach(team => {
                    const scoreDiv = document.createElement('div');
                    scoreDiv.className = 'score-item';
                    scoreDiv.innerHTML = `
                        <h3>${team.name}</h3>
                        <div class="score">${gameState.scores[team.id] || 0}</div>
                    `;
                    roundScores.appendChild(scoreDiv);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            const currentPlayerCarriedTime = gameState.playerCarriedTime && gameState.currentPlayer 
                ? (gameState.playerCarriedTime[gameState.currentPlayer.id] || 0)
                : 0;
            
            if (currentPlayerCarriedTime > 0) {
                const timeInfo = document.createElement('div');
                timeInfo.className = 'score-item';
                timeInfo.style.marginTop = '20px';
                timeInfo.innerHTML = `
                    <h3>–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
                    <div class="score">${currentPlayerCarriedTime} —Å–µ–∫</div>
                `;
                roundScores.appendChild(timeInfo);
            }
        }

        function continueToNextRound() {
            const nextRound = gameState.currentRound + 1;
            
            if (nextRound > 3) {
                // –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                showResults();
            } else {
                // –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª–∞ –≤—Ç–æ—Ä–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –≤–º–µ—Å—Ç–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
                if (nextRound === 2) {
                    showScreen('rulesScreen2');
                } else {
                    // –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏—Ö —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å—Ä–∞–∑—É
                    sendEvent('continue_round');
                    showScreen('gameScreen');
                    console.log('continueToNextRound - –∂–¥–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è game_state –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–∞–π–º–µ—Ä–∞');
                    // –¢–∞–π–º–µ—Ä –±—É–¥–µ—Ç –∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ game_state
                }
            }
        }

        function showResults() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            determineWinner();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            showTeamStats();
        }

        function determineWinner() {
            const winner = document.getElementById('winner');
            
            if (gameState.teams && gameState.teamStatsByRound) {
                let maxScore = -Infinity;
                let winnerTeam = null;
                let teamsWithMaxScore = [];
                
                // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Å—á–µ—Ç (—Å—É–º–º–∞ –ø–æ –≤—Å–µ–º —Ä–∞—É–Ω–¥–∞–º)
                gameState.teams.forEach(team => {
                    const round1Score = gameState.teamStatsByRound[0][team.id] || 0;
                    const round2Score = gameState.teamStatsByRound[1][team.id] || 0;
                    const round3Score = gameState.teamStatsByRound[2][team.id] || 0;
                    const totalScore = round1Score + round2Score + round3Score;
                    
                    if (totalScore > maxScore) {
                        maxScore = totalScore;
                    }
                });
                
                // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å—á–µ—Ç–æ–º
                gameState.teams.forEach(team => {
                    const round1Score = gameState.teamStatsByRound[0][team.id] || 0;
                    const round2Score = gameState.teamStatsByRound[1][team.id] || 0;
                    const round3Score = gameState.teamStatsByRound[2][team.id] || 0;
                    const totalScore = round1Score + round2Score + round3Score;
                    
                    if (totalScore === maxScore) {
                        teamsWithMaxScore.push(team);
                    }
                });
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (teamsWithMaxScore.length === 1) {
                    // –ï—Å—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
                    winnerTeam = teamsWithMaxScore[0];
                    winner.textContent = `üèÜ –ü–æ–±–µ–¥–∏–ª–∞ ${winnerTeam.name}!`;
                } else {
                    // –ù–∏—á—å—è
                    winner.textContent = `ü§ù –ù–∏—á—å—è!`;
                }
            }
        }

        function showTeamStats() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.stats-navigation .btn').forEach(btn => {
                btn.classList.remove('btn-active');
            });
            document.querySelectorAll('.stats-navigation .btn')[0].classList.add('btn-active');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–∞–Ω–¥
            const teamStatsBody = document.getElementById('teamStatsBody');
            teamStatsBody.innerHTML = '';
            
            console.log('showTeamStats - gameState.scores:', gameState.scores);
            console.log('showTeamStats - gameState.teamStatsByRound:', gameState.teamStatsByRound);
            
            if (gameState.teams && gameState.teamStatsByRound) {
                gameState.teams.forEach(team => {
                    const row = document.createElement('tr');
                    
                    const round1Score = gameState.teamStatsByRound[0][team.id] || 0;
                    const round2Score = gameState.teamStatsByRound[1][team.id] || 0;
                    const round3Score = gameState.teamStatsByRound[2][team.id] || 0;
                    const totalScore = round1Score + round2Score + round3Score;
                    const serverTotalScore = gameState.scores[team.id] || 0;
                    
                    console.log(`–ö–æ–º–∞–Ω–¥–∞ ${team.name}: —Ä–∞—É–Ω–¥1=${round1Score}, —Ä–∞—É–Ω–¥2=${round2Score}, —Ä–∞—É–Ω–¥3=${round3Score}, —Å—É–º–º–∞=${totalScore}, —Å–µ—Ä–≤–µ—Ä=${serverTotalScore}`);
                    
                    row.innerHTML = `
                        <td><strong>${team.name || '–ö–æ–º–∞–Ω–¥–∞'}</strong></td>
                        <td class="${getScoreClass(round1Score)}">${round1Score}</td>
                        <td class="${getScoreClass(round2Score)}">${round2Score}</td>
                        <td class="${getScoreClass(round3Score)}">${round3Score}</td>
                        <td class="${getScoreClass(totalScore)}"><strong>${totalScore}</strong></td>
                    `;
                    
                    teamStatsBody.appendChild(row);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–æ–º–∞–Ω–¥
            showScreen('teamResultsScreen');
        }

        function showPlayerStats() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.stats-navigation .btn').forEach(btn => {
                btn.classList.remove('btn-active');
            });
            document.querySelectorAll('.stats-navigation .btn')[1].classList.add('btn-active');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
            const playerStatsBody = document.getElementById('playerStatsBody');
            playerStatsBody.innerHTML = '';
            
            if (gameState.players && gameState.playerStats) {
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –æ—á–∫–∞–º (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
                const sortedPlayers = [...gameState.players].sort((a, b) => {
                    const scoreA = gameState.playerStats[a.id]?.totalScore || 0;
                    const scoreB = gameState.playerStats[b.id]?.totalScore || 0;
                    return scoreB - scoreA;
                });
                
                sortedPlayers.forEach(player => {
                    const stats = gameState.playerStats[player.id] || { guessed: 0, passed: 0, totalScore: 0 };
                    
                    // –ù–∞—Ö–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –∏–≥—Ä–æ–∫–∞
                    const playerTeam = gameState.teams.find(team => 
                        team.players && team.players.includes(player.id)
                    );
                    const teamName = playerTeam ? playerTeam.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${player.name || '–ò–≥—Ä–æ–∫'}</strong></td>
                        <td class="${getScoreClass(stats.totalScore)}"><strong>${stats.totalScore}</strong></td>
                    `;
                    
                    playerStatsBody.appendChild(row);
                });
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–≥—Ä–æ–∫–æ–≤
            showScreen('playerResultsScreen');
        }

        function getScoreClass(score) {
            if (score > 0) return 'score-positive';
            if (score < 0) return 'score-negative';
            return 'score-zero';
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º –≤—Ä–µ–º–µ–Ω–∏ –≤ localStorage
        function saveCarriedTime(timeLeft) {
            if (timeLeft > 0) {
                localStorage.setItem('hatGame_carriedTime', timeLeft.toString());
                console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è:', timeLeft, '—Å–µ–∫—É–Ω–¥');
            } else {
                localStorage.removeItem('hatGame_carriedTime');
                console.log('–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ—á–∏—â–µ–Ω–æ');
            }
        }

        function loadCarriedTime() {
            const saved = localStorage.getItem('hatGame_carriedTime');
            const carriedTime = saved ? parseFloat(saved) : 0;
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è:', carriedTime, '—Å–µ–∫—É–Ω–¥');
            return carriedTime;
        }

        function clearCarriedTime() {
            localStorage.removeItem('hatGame_carriedTime');
            console.log('–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –æ—á–∏—â–µ–Ω–æ');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function calculateCarriedTime() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∏–∑ —Ç–∞–π–º–µ—Ä–∞
            // timerState.remainingTime —É–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—É–∑—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã—á–∏—Å–ª–µ–Ω–æ
            const carriedTime = Math.max(0, timerState.remainingTime);
            
            console.log('calculateCarriedTime:', {
                remainingTime: Math.round(timerState.remainingTime / 1000) + 's',
                duration: Math.round(timerState.duration / 1000) + 's',
                carriedTime: Math.round(carriedTime / 1000) + 's',
                isRunning: timerState.isRunning,
                isPaused: timerState.isPaused
            });

            return Math.ceil(carriedTime / 1000); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞ –ø–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—é —Å–ª–æ–≤
        function endRoundByWordsExhausted() {
            console.log('–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à–µ–Ω –ø–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—é —Å–ª–æ–≤');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ä–∞—É–Ω–¥ –µ—â–µ –Ω–µ –±—ã–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            if (timerState.roundEndProcessed) {
                console.log('–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞—É–Ω–¥–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–∞–π–º–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–ª
            if (!timerState.isRunning) {
                console.log('–¢–∞–π–º–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏');
                return;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ —Ä–∞—É–Ω–¥ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
            timerState.roundEndProcessed = true;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            stopTimer();
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
            let carriedTime = calculateCarriedTime();
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞–∑—É–º–Ω–æ–µ (–Ω–µ –±–æ–ª—å—à–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—É–Ω–¥–∞)
            if (carriedTime > gameSetup.roundDuration) {
                console.log('–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –±–æ–ª—å—à–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—É–Ω–¥–∞, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 0');
                carriedTime = 0;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤ localStorage
            saveCarriedTime(carriedTime);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            if (carriedTime > 0) {
                sendEvent('round_completed_carried_time', { carriedTime: carriedTime });
            }
            
            console.log('–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞—É–Ω–¥–∞:', carriedTime, '—Å–µ–∫—É–Ω–¥');
        }

        // –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–π–º–µ—Ä–æ–º
        function startTimer(durationSeconds, carriedTimeSeconds = 0) {
            stopTimer();
            
            console.log('startTimer –≤—ã–∑–≤–∞–Ω —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:', { durationSeconds, carriedTimeSeconds });
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: durationSeconds —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–ª–∏–±–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ, –ª–∏–±–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ)
            // carriedTimeSeconds –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—á–∏—Å—Ç–∫–∏ localStorage
            const actualDuration = durationSeconds;
            const totalDuration = actualDuration * 1000;
            
            console.log('startTimer - carriedTimeSeconds:', carriedTimeSeconds, 'actualDuration:', actualDuration, 'totalDuration:', totalDuration);
            
            timerState.duration = totalDuration;
            timerState.remainingTime = totalDuration;
            timerState.startTime = performance.now();
            timerState.roundStartTime = performance.now(); // –§–∏–∫—Å–∏—Ä—É–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞—É–Ω–¥–∞
            timerState.pausedDuration = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –ø–∞—É–∑
            timerState.isRunning = true;
            timerState.isPaused = false;
            timerState.carriedTime = 0; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            timerState.roundEndProcessed = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—É–Ω–¥–∞
            timerState.warningPlayed = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —Å—Ç–∞—Ä—Ç–∞ —Ö–æ–¥–∞
            playSound('startTurn');
            
            // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è, –æ—á–∏—â–∞–µ–º –µ–≥–æ –∏–∑ localStorage
            if (carriedTimeSeconds > 0) {
                clearCarriedTime();
                console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è:', carriedTimeSeconds, '—Å–µ–∫—É–Ω–¥');
            }
            
            updateTimerDisplay();
            timerLoop();
        }

        function stopTimer() {
            timerState.isRunning = false;
            timerState.isPaused = false;
            if (timerState.animationFrameId) {
                cancelAnimationFrame(timerState.animationFrameId);
                timerState.animationFrameId = null;
            }
        }

        function pauseTimer() {
            if (timerState.isRunning && !timerState.isPaused) {
                timerState.isPaused = true;
                timerState.pauseStartTime = performance.now(); // –§–∏–∫—Å–∏—Ä—É–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –ø–∞—É–∑—ã
                if (timerState.animationFrameId) {
                    cancelAnimationFrame(timerState.animationFrameId);
                    timerState.animationFrameId = null;
                }
            }
        }

        function resumeTimer() {
            if (timerState.isRunning && timerState.isPaused) {
                timerState.isPaused = false;
                // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–∞—É–∑—ã –∫ –æ–±—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏ –ø–∞—É–∑
                if (timerState.pauseStartTime) {
                    timerState.pausedDuration += performance.now() - timerState.pauseStartTime;
                    timerState.pauseStartTime = null;
                }
                // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å —É—á–µ—Ç–æ–º –ø–∞—É–∑—ã
                timerState.startTime = performance.now() - (timerState.duration - timerState.remainingTime);
                timerLoop();
            }
        }

        function resetTimer() {
            stopTimer();
            timerState = {
                isRunning: false,
                isPaused: false,
                startTime: null,
                duration: 30000,
                remainingTime: 30000,
                animationFrameId: null,
                carriedTime: 0,
                roundStartTime: null,
                pausedDuration: 0,
                pauseStartTime: null,
                roundEndProcessed: false,
                warningPlayed: false
            };
        }

        function timerLoop() {
            if (!timerState.isRunning || timerState.isPaused) {
                return;
            }

            const now = performance.now();
            const elapsed = now - timerState.startTime;
            timerState.remainingTime = Math.max(0, timerState.duration - elapsed);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            const secondsLeft = Math.ceil(timerState.remainingTime / 1000);
            if (secondsLeft === 5 && !timerState.warningPlayed) {
                playSound('warning5s');
                timerState.warningPlayed = true;
            }

            updateTimerDisplay();

            if (timerState.remainingTime <= 0) {
                timerState.isRunning = false;
                playSound('endTurn');
                const carriedTime = 0;
                saveCarriedTime(carriedTime);
                sendEvent('time_up', { carriedTime: carriedTime });
            } else {
                timerState.animationFrameId = requestAnimationFrame(timerLoop);
            }
        }

        function updateTimerDisplay() {
            const seconds = Math.ceil(timerState.remainingTime / 1000);
            document.getElementById('timer').textContent = seconds;
        }

        function showPlayerIntroScreen() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            stopTimer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –∏–≥—Ä–æ–∫–µ
            const currentPlayerName = document.getElementById('currentPlayerName');
            const currentPlayerTeam = document.getElementById('currentPlayerTeam');
            
            if (gameState.currentPlayer) {
                currentPlayerName.textContent = gameState.currentPlayer.name;
                
                // –ù–∞—Ö–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –∏–≥—Ä–æ–∫–∞
                const playerTeam = gameState.teams.find(team => 
                    team.players && team.players.includes(gameState.currentPlayer.id)
                );
                if (playerTeam) {
                    currentPlayerTeam.textContent = playerTeam.name;
                } else {
                    currentPlayerTeam.textContent = '';
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
            showScreen('playerIntroScreen');
        }

        function showHandoffScreen(data) {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            stopTimer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–ª–µ–¥—É—é—â–µ–º –∏–≥—Ä–æ–∫–µ
            const nextPlayerName = document.getElementById('nextPlayerName');
            const nextPlayerTeam = document.getElementById('nextPlayerTeam');
            
            if (data.nextPlayer) {
                nextPlayerName.textContent = data.nextPlayer.name;
                
                // –ù–∞—Ö–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É –∏–≥—Ä–æ–∫–∞
                const playerTeam = gameState.teams.find(team => 
                    team.players && team.players.includes(data.nextPlayer.id)
                );
                if (playerTeam) {
                    nextPlayerTeam.textContent = playerTeam.name;
                } else {
                    nextPlayerTeam.textContent = '';
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –ø–µ—Ä–µ–¥–∞—á–∏ —Ö–æ–¥–∞
            showScreen('handoffScreen');
        }

        function startPlayerTurn() {
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —ç–∫—Ä–∞–Ω—É –∏–≥—Ä—ã
            showScreen('gameScreen');
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Ö–æ–¥–∞ –∏–≥—Ä–æ–∫–∞ (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)
            const currentPlayerCarriedTime = gameState.playerCarriedTime && gameState.currentPlayer 
                ? (gameState.playerCarriedTime[gameState.currentPlayer.id] || 0)
                : 0;
            
            console.log('startPlayerTurn - currentPlayerCarriedTime:', currentPlayerCarriedTime);
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            // –ï—Å–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è > 0, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ –ø–æ–ª–Ω–æ–µ –≤—Ä–µ–º—è —Ç–∞–π–º–µ—Ä–∞
            // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞
            const timerDuration = currentPlayerCarriedTime > 0 ? currentPlayerCarriedTime : gameSetup.roundDuration;
            startTimer(timerDuration, currentPlayerCarriedTime);
        }

        function startNextTurn() {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –æ –Ω–∞—á–∞–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ö–æ–¥–∞
            sendEvent('start_next_turn');
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —ç–∫—Ä–∞–Ω—É –∏–≥—Ä—ã
            showScreen('gameScreen');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∏–∑ localStorage –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ö–æ–¥–∞
            const carriedTime = loadCarriedTime();
            
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤—Ä–µ–º—è, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            // –ï—Å–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è > 0, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –∫–∞–∫ –ø–æ–ª–Ω–æ–µ –≤—Ä–µ–º—è —Ç–∞–π–º–µ—Ä–∞
            // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –≤—Ä–µ–º—è —Ä–∞—É–Ω–¥–∞
            const timerDuration = carriedTime > 0 ? carriedTime : gameSetup.roundDuration;
            startTimer(timerDuration, carriedTime);
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        function validatePlayerCount() {
            const playerCountSelect = document.getElementById('playerCount');
            const playerCount = parseInt(playerCountSelect.value);
            
            if (playerCount < 4 || playerCount > 20) {
                alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 4 –¥–æ 20.');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                playerCountSelect.value = '4';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ç–∞–π–º–µ—Ä–∞
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && timerState.isRunning && !timerState.isPaused) {
                // –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–Ω–æ–≤–∞ –≤–∏–¥–∏–º–∞, –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Ç–∞–π–º–µ—Ä
                const now = performance.now();
                const elapsed = now - timerState.startTime;
                timerState.remainingTime = Math.max(0, timerState.duration - elapsed);
                updateTimerDisplay();
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ localStorage)
            setTimeout(initDifficultyControls, 100);
            
            // Debug-–ø–∞–Ω–µ–ª—å: –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª–æ–≤ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            (function initDebugPanel(){
                const stored = localStorage.getItem('hat_debug_highlight_elevated');
                window.__hatDebug = { highlightElevated: stored === '1' };
                const panel = document.createElement('div');
                panel.style.position = 'fixed';
                panel.style.right = '8px';
                panel.style.bottom = '8px';
                panel.style.padding = '6px 10px';
                panel.style.background = 'rgba(0,0,0,0.5)';
                panel.style.color = '#fff';
                panel.style.fontSize = '12px';
                panel.style.borderRadius = '6px';
                panel.style.zIndex = '9999';
                panel.style.userSelect = 'none';
                panel.style.cursor = 'default';
                panel.style.display = 'inline-flex';
                panel.style.alignItems = 'center';
                panel.style.gap = '6px';
                const label = document.createElement('label');
                label.style.display = 'inline-flex';
                label.style.alignItems = 'center';
                label.style.gap = '6px';
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = !!window.__hatDebug.highlightElevated;
                checkbox.addEventListener('change', () => {
                    window.__hatDebug.highlightElevated = checkbox.checked;
                    localStorage.setItem('hat_debug_highlight_elevated', checkbox.checked ? '1' : '0');
                    updateGameDisplay();
                });
                const span = document.createElement('span');
                span.textContent = 'Debug: –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤';
                label.appendChild(checkbox);
                label.appendChild(span);
                panel.appendChild(label);

                document.body.appendChild(panel);
            })();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤
            const playerCountSelect = document.getElementById('playerCount');
            if (playerCountSelect) {
                playerCountSelect.addEventListener('change', validatePlayerCount);
            }
            // –ù–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–Ω–∏–º–∞–µ–º –ª—é–±—É—é –≤–æ–∑–º–æ–∂–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
            if (typeof toggleButtonsDuringPause === 'function') {
                toggleButtonsDuringPause(false);
            }
        });
    </script>
</body>
</html>
