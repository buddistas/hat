/*
  Append additional high-frequency nouns to reach a target of 100 newly added entries
  across these categories only:
    - Флора и фауна
    - Развлечения и хобби
    - Вещи и предметы быта
    - Музыка

  Assumption: earlier step already appended 43 entries.
  This script will append up to 57 more unique entries (skipping any that already exist),
  avoiding instrument/performer conflicts by adding only instruments/neutral music terms.
*/

const fs = require('fs');
const path = require('path');

const TARGET_MORE = 57;

function normalize(s) {
  return String(s).trim().toUpperCase().replace(/Ё/g, 'Е');
}

const csvPath = path.join(__dirname, '..', 'public', 'words.csv');
if (!fs.existsSync(csvPath)) {
  console.error('public/words.csv not found');
  process.exit(1);
}

const existing = fs
  .readFileSync(csvPath, 'utf8')
  .split(/\r?\n/)
  .map(l => l.trim())
  .filter(Boolean)
  .map(l => l.split(',')[0])
  .map(normalize);
const existingSet = new Set(existing);

const C = {
  flora: 'Флора и фауна',
  hobby: 'Развлечения и хобби',
  household: 'Вещи и предметы быта',
  music: 'Музыка',
};

// Large candidate pool to ensure enough uniques
const pool = [
  // Флора и фауна (additional common species and plant parts)
  'КРОЛИК','МЫШЬ','ХОМЯК','НУТРИЯ','БУРАНДУК','СОБОЛЬ','КУНИЦА','ВЫДРА','ОНДАТРА','ХОРЕК',
  'КОЗЕЛ','ЯК','БУЙВОЛ','ВЕРБЛЮД','ЛАМА','АЛЬПАКА','КОСУЛЯ','КАБАН','БАРСУК','НОРКА','ЛАСЬКА',
  'СОРОКА','КУКУШКА','СОЛОВЕЙ','ЖАВОРОНОК','ГАЛКА','СВИРЕСТЕЛЬ','СНЕГИРЬ','СИНИЦА','УДОД','ФЛАМИНГО',
  'ПЕЛИКАН','АЛЬБАТРОС','БУРЕВЕСТНИК','ЧАЙКА','КОРШУН','КАНЮК','КОНДОР','ПАВЛИН','ПИНГВИН','ТУКАН',
  'ЩЕГОЛ','КОЛИБРИ','СТРАУС','ЭМУ',
  'КАРАСЬ','ЛЕЩ','СЕЛЬДЬ','САЙРА','СКУМБРИЯ','ТУНЕЦ','ПАЛТУС','СУДАК',
  'УЖ','ГАДЮКА','КОБРА','АНАКОНДА','ИГУАНА','ХАМЕЛЕОН',
  'ЛЯГУШКА','ЖАБА','ТРИТОН','САЛАМАНДРА',
  'ПАУК-ТАРАНТУЛ','СКОРПИОН','САРАНЧА','КОЗЯВКА',
  'КОРЕНЬ','СТВОЛ','ВЕТКА','ПОЧКА','КОРA','СЕНО',
  'РОМАШКА','ТЮЛЬПАН','ГВОЗДИКА','ПИОН','ИРИС','ЛИЛИЯ','ПОДСНЕЖНИК','ЛОТОС','КУВШИНКА',
  'ДУБ','КЛЕН','ЛИПА','ТОПОЛЬ','ЯСЕНЬ','БЕРЕЗА','СОСНА','ЕЛЬ','ПИХТА','ИВА',
  'ЯБЛОНЯ','ГРУША','ВИШНЯ','СЛИВА','ЧЕРЕШНЯ','АПЕЛЬСИН','ЛИМОН','ГРЕЙПФРУТ','ФИГОВОЕ ДЕРЕВО',

  // Развлечения и хобби (activities and items)
  'ПАЗЛ','КАРТЫ','КРОССВОРД','СУДОКУ','ШАРАДЫ','РИСОВАНИЕ','АКВАРЕЛЬ','ГУАШЬ','ЛЕПКА','ПЛЕТЕНИЕ',
  'ОРИГАМИ','КАЛЛИГРАФИЯ','ЖИВОПИСЬ','ГРАВЮРА','ФОТОГРАФИЯ','КИНО','ТЕАТР','ЦИРК','КАРАОКЕ','КЕМПИНГ',
  'ПОХОД','ПАЛАТКА','ПИКНИК','ВЕЛОПРОГУЛКА','РОЛИКИ','КОНЬКИ','САНКИ','СНЕГОКАТ','ГРИЛЬ','БАРБЕКЮ',
  'ВЯЗАНИЕ','ШИТЬЕ','ВЫШИВКА','МАКРАМЕ','ВЫЖИГАНИЕ',

  // Вещи и предметы быта (household items and tools; many basic ones)
  'ПОДУШКА','ОДЕЯЛО','ПЛЕД','ПОКРЫВАЛО','ПРОСТЫНЯ','НАВОЛОЧКА','ПОЛОТЕНЦЕ','ЗАНАВЕСКА','ТЮЛЬ','ШТОРА',
  'КОВЕР','КОВРИК','ПРИХВАТКА','СКАТЕРТЬ','ПОДНОС','ПОДСТАКАННИК','СОЛОНКА','ПЕРЕЧНИЦА',
  'КУВШИН','ГРАФИН','БУТЫЛКА','СТАКАН','КОФЕЙНИК','ЧАЙНИК','ТЕРМОС','КРУЖКА',
  'ЛОЖКА','ВИЛКА','НОЖ','ПОВАРЕЖКА','ПОЛОВНИК','ЩИПЦЫ','ТЕРКА','СИТЕЧКО',
  'СКОВОРОДА','КАСТРЮЛЯ','КАЗАН','ПРОТИВЕНЬ','ДУХОВКА',
  'МИСКА','ТАРЕЛКА','САЛАТНИЦА','СУПНИЦА','САХАРНИЦА',
  'МЫЛО','ШАМПУНЬ','КРЕМ','ГУБКА','ЩЕТКА','ШВАБРА','МЕТЛА','СОВОК','ВЕДРО','ТАЗ',
  'СТИРАЛЬНЫЙ ПОРОШОК','ОТБЕЛИВАТЕЛЬ','КОНДИЦИОНЕР ДЛЯ БЕЛЬЯ','ПЛАСТЫРЬ','БИНТ','ТЕРМОМЕТР',
  'ЗУБНАЯ ЩЕТКА','ЗУБНАЯ ПАСТА','ТУАЛЕТНАЯ БУМАГА','ПОЛОТЕР',
  'БУМАГА','ТЕТРАДЬ','РУЧКА','КАРАНДАШ','ЛАСТИК','ЛИНЕЙКА','КОНВЕРТ','ПАПКА','КЛЕЙ','СКОТЧ','НОЖНИЦЫ',
  'ФОНАРИК','ЗАЖИГАЛКА','СПИЧКИ','БАТАРЕЙКА',

  // Музыка (instruments and neutral terms only)
  'САКСОФОН','КЛАРНЕТ','ФАГОТ','ГОБОЙ','ФЛЕЙТА','ПИККОЛО','ТРОМБОН','ТРУБА','КОРНЕТ','БАРИТОН',
  'СУРДИНА','ФОРТЕПИАНО','РОЯЛЬ','СИНТЕЗАТОР','СЕМИПЬЯНО','ЭЛЕКТРОГИТАРА','БАС-ГИТАРА','МАНДОЛИНА','УКУЛЕЛЕ','БУЗУКИ',
  'СИТАР','САРОД','ТАБЛА','КАХОН','КОНГИ','БОНГО','ДЖЕМБЕ','КАСТАНЬЕТЫ','ГУИРО','МАРАКАСЫ',
  'ВИБРАФОН','КСИЛОФОН','МЕТАЛЛОФОН','МАРИМБА','ТИМПАНЫ','ЛИТАВРЫ','ТАРЕЛКИ','ТРЕУГОЛЬНИК','БУБЕН','ТАМТАМ',
  'ОРГАН','АРФА','ГУСЛИ','ДОМРА','БАЛАЛАЙКА','АККОРДЕОН','БАЯН','БАНДУРА','ДУДУК','ОКАРИНА'
];

const candidates = pool.map(word => ({ word, category: guessCategory(word), level: 'обычный' }));

function guessCategory(word) {
  // Minimal routing based on known groupings above
  const floraIdx = 0;
  // We encoded by sections; rough routing:
  // If word is in an explicit instruments/terms list → music
  const musicSet = new Set([
    'САКСОФОН','КЛАРНЕТ','ФАГОТ','ГОБОЙ','ФЛЕЙТА','ПИККОЛО','ТРОМБОН','ТРУБА','КОРНЕТ','БАРИТОН','СУРДИНА','ФОРТЕПИАНО','РОЯЛЬ','СИНТЕЗАТОР','СЕМИПЬЯНО','ЭЛЕКТРОГИТАРА','БАС-ГИТАРА','МАНДОЛИНА','УКУЛЕЛЕ','БУЗУКИ','СИТАР','САРОД','ТАБЛА','КАХОН','КОНГИ','БОНГО','ДЖЕМБЕ','КАСТАНЬЕТЫ','ГУИРО','МАРАКАСЫ','ВИБРАФОН','КСИЛОФОН','МЕТАЛЛОФОН','МАРИМБА','ТИМПАНЫ','ЛИТАВРЫ','ТАРЕЛКИ','ТРЕУГОЛЬНИК','БУБЕН','ТАМТАМ','ОРГАН','АРФА','ГУСЛИ','ДОМРА','БАЛАЛАЙКА','АККОРДЕОН','БАЯН','БАНДУРА','ДУДУК','ОКАРИНА'
  ]);
  if (musicSet.has(word)) return C.music;

  const householdSet = new Set([
    'ПОДУШКА','ОДЕЯЛО','ПЛЕД','ПОКРЫВАЛО','ПРОСТЫНЯ','НАВОЛОЧКА','ПОЛОТЕНЦЕ','ЗАНАВЕСКА','ТЮЛЬ','ШТОРА','КОВЕР','КОВРИК','ПРИХВАТКА','СКАТЕРТЬ','ПОДНОС','ПОДСТАКАННИК','СОЛОНКА','ПЕРЕЧНИЦА','КУВШИН','ГРАФИН','БУТЫЛКА','СТАКАН','КОФЕЙНИК','ЧАЙНИК','ТЕРМОС','КРУЖКА','ЛОЖКА','ВИЛКА','НОЖ','ПОВАРЕЖКА','ПОЛОВНИК','ЩИПЦЫ','ТЕРКА','СИТЕЧКО','СКОВОРОДА','КАСТРЮЛЯ','КАЗАН','ПРОТИВЕНЬ','ДУХОВКА','МИСКА','ТАРЕЛКА','САЛАТНИЦА','СУПНИЦА','САХАРНИЦА','МЫЛО','ШАМПУНЬ','КРЕМ','ГУБКА','ЩЕТКА','ШВАБРА','МЕТЛА','СОВОК','ВЕДРО','ТАЗ','СТИРАЛЬНЫЙ ПОРОШОК','ОТБЕЛИВАТЕЛЬ','КОНДИЦИОНЕР ДЛЯ БЕЛЬЯ','ПЛАСТЫРЬ','БИНТ','ТЕРМОМЕТР','ЗУБНАЯ ЩЕТКА','ЗУБНАЯ ПАСТА','ТУАЛЕТНАЯ БУМАГА','ПОЛОТЕР','БУМАГА','ТЕТРАДЬ','РУЧКА','КАРАНДАШ','ЛАСТИК','ЛИНЕЙКА','КОНВЕРТ','ПАПКА','КЛЕЙ','СКОТЧ','НОЖНИЦЫ','ФОНАРИК','ЗАЖИГАЛКА','СПИЧКИ','БАТАРЕЙКА'
  ]);
  if (householdSet.has(word)) return C.household;

  const hobbySet = new Set([
    'ПАЗЛ','КАРТЫ','КРОССВОРД','СУДОКУ','ШАРАДЫ','РИСОВАНИЕ','АКВАРЕЛЬ','ГУАШЬ','ЛЕПКА','ПЛЕТЕНИЕ','ОРИГАМИ','КАЛЛИГРАФИЯ','ЖИВОПИСЬ','ГРАВЮРА','ФОТОГРАФИЯ','КИНО','ТЕАТР','ЦИРК','КАРАОКЕ','КЕМПИНГ','ПОХОД','ПАЛАТКА','ПИКНИК','ВЕЛОПРОГУЛКА','РОЛИКИ','КОНЬКИ','САНКИ','СНЕГОКАТ','ГРИЛЬ','БАРБЕКЮ','ВЯЗАНИЕ','ШИТЬЕ','ВЫШИВКА','МАКРАМЕ','ВЫЖИГАНИЕ'
  ]);
  if (hobbySet.has(word)) return C.hobby;

  return C.flora;
}

const seen = new Set();
const filtered = candidates.filter(({ word }) => {
  const n = normalize(word);
  if (existingSet.has(n)) return false;
  if (seen.has(n)) return false;
  seen.add(n);
  return true;
});

const toAppend = filtered.slice(0, TARGET_MORE);
const block = toAppend.map(e => `${e.word},${e.category},${e.level}`).join('\n');

if (!toAppend.length) {
  console.log('No new entries to append.');
  process.exit(0);
}

fs.appendFileSync(csvPath, (existing.length ? '\n' : '') + block + '\n');
console.log(`Appended ${toAppend.length} entries to public/words.csv`);


