const fs = require('fs');
const path = require('path');

// Normalize for duplicate detection consistent with validator
function normalizeForSet(s) {
  return String(s)
    .toLowerCase()
    .trim()
    .replace(/ё/g, 'е')
    .replace(/[.,!?:;"'()\-–—]/g, '')
    .replace(/\s+/g, ' ')
    .trim();
}

function toCsvEntry(word) {
  return `${word},Вещи и предметы быта,обычный`;
}

const csvPath = path.join(__dirname, '..', 'public', 'words.csv');
if (!fs.existsSync(csvPath)) {
  console.error('public/words.csv not found');
  process.exit(1);
}

const existingNorms = new Set(
  fs
    .readFileSync(csvPath, 'utf8')
    .split(/\r?\n/)
    .map(l => l.trim())
    .filter(Boolean)
    .map(line => line.split(',')[0])
    .map(normalizeForSet)
);

// Large candidate pool of common non-electronic household items (uppercase, noun phrases)
// Focus: furniture, kitchenware, tableware, textiles, cleaning, storage, stationery (non-digital)
const candidates = [
  'СТОЛ', 'СТУЛ', 'КРОВАТЬ', 'ШКАФ', 'ДИВАН', 'ПОЛКА', 'ЗЕРКАЛО', 'ЛАМПА', 'КОВЕР', 'ШТОРА',
  'ПОДУШКА', 'ОДЕЯЛО', 'ПРОСТЫНЯ', 'ПЛЕД', 'МАТРАС', 'ТУМБОЧКА', 'КОМОД', 'СТОЛИК', 'ВЕШАЛКА', 'ПИСЬМЕННЫЙ СТОЛ',
  'КРЕСЛО', 'ТАБУРЕТ', 'КУХОННЫЙ СТОЛ', 'КУХОННЫЙ ШКАФ', 'СКОВОРОДА', 'КАСТРЮЛЯ', 'ЧАЙНИК ДЛЯ ЗАВАРКИ', 'ТАРЕЛКА', 'ЧАШКА', 'БЛЮДЦЕ',
  'СТАКАН', 'ВИЛКА', 'ЛОЖКА', 'НОЖ', 'РАЗДЕЛОЧНАЯ ДОСКА', 'САЛФЕТКА', 'СКАТЕРТЬ', 'КУХОННОЕ ПОЛОТЕНЦЕ', 'МУСОРНОЕ ВЕДРО', 'ШВАБРА',
  'ВЕДРО', 'ГУБКА', 'ЩЕТКА', 'СОВОК', 'СУШИЛКА ДЛЯ БЕЛЬЯ', 'ГЛАДИЛЬНАЯ ДОСКА', 'ПЫЛЕСБОРНИК', 'СОВОК С ЩЕТКОЙ', 'КОВРИК ДЛЯ ВАННОЙ', 'ЗАНАВЕСКА ДЛЯ ВАННОЙ',
  'МЫЛЬНИЦА', 'ДОЗАТОР ДЛЯ МЫЛА', 'ЗУБНАЯ ЩЕТКА', 'ЗУБНАЯ ПАСТА', 'ЗУБНАЯ НИТЬ', 'РАСЧЕСКА', 'ФЕН ДЛЯ ВОЛОС', 'ПОЛОТЕНЦЕДЕРЖАТЕЛЬ', 'ДЕРЖАТЕЛЬ ДЛЯ ТУАЛЕТНОЙ БУМАГИ', 'ТУАЛЕТНАЯ БУМАГА',
  'ЙОРШИК ДЛЯ ТУАЛЕТА', 'АРОМАТИЗАТОР ВОЗДУХА', 'ОСВЕЖИТЕЛЬ ВОЗДУХА', 'КРЮЧОК ДЛЯ ОДЕЖДЫ', 'КЛЮЧНИЦА', 'КОРЗИНА ДЛЯ БЕЛЬЯ', 'КОРЗИНА ДЛЯ МУСОРА', 'КОРЗИНА ПЛЕТЕНАЯ', 'КОРОБКА ДЛЯ ХРАНЕНИЯ', 'ОРГАНАЙЗЕР',
  'ШКАТУЛКА', 'СУНДУК', 'ЯЩИК', 'ПОДНОС', 'ПОДСТАКАННИК', 'САЛФЕТНИЦА', 'САХАРНИЦА', 'СОЛОНКА', 'ПЕРЕЧНИЦА', 'САЛАТНИЦА',
  'ПОЛОВНИК', 'ПОВАРЕЖКА', 'ЩИПЦЫ', 'ТЕРКА', 'СИТЕЧКО', 'СИТО', 'ДУРШЛАГ', 'ПРОТИВЕНЬ', 'ФОРМА ДЛЯ ВЫПЕЧКИ', 'ФОРМОЧКА ДЛЯ ПЕЧЕНЬЯ',
  'ПИЩЕВАЯ ПЛЕНКА', 'ФОЛЬГА', 'ПЕРГАМЕНТ', 'ПРИХВАТКА', 'РУКАВИЦА КУХОННАЯ', 'СКАЛКА', 'РАЗЪЕМНАЯ ФОРМА', 'КАЗАН', 'КОВШ', 'КУВШИН',
  'ГРАФИН', 'МИСКА', 'СУПНИЦА', 'МАСЛЕНКА', 'СОУСНИК', 'ВАФЕЛЬНИЦА ДЛЯ ПЕЧЕНЬЯ', 'НОЖ ДЛЯ ХЛЕБА', 'НОЖ ДЛЯ ОВОЩЕЙ', 'ОВОЩЕЧИСТКА', 'ОТКРЫВАЛКА',
  'ШТОПОР', 'ТЕРМОС', 'КРУЖКА', 'КРЕМАНКА', 'ПИАЛА', 'БОКАЛ', 'БЛЮДО ДЛЯ ЗАПЕКАНИЯ', 'ПОДСТАВКА ПОД ГОРЯЧЕЕ', 'КОВРИК ПРИДВЕРНЫЙ', 'КОВРИК КУХОННЫЙ',
  'ПЛИНТУС', 'ГАЛОШНИЦА', 'ОБУВНИЦА', 'ПОЛКА ДЛЯ ОБУВИ', 'ЗОНТНИЦА', 'ЗОНТ', 'ВЕШАЛКА НАСТЕННАЯ', 'ВЕШАЛКА НАПОЛЬНАЯ', 'СКЛАДНОЙ ТАБУРЕТ', 'ПУФ',
  'ПУФИК', 'ТАХТА', 'ТРЮМО', 'ЛЮСТРА', 'БРА', 'ТОРШЕР', 'ЛАМПА НАСТОЛЬНАЯ', 'ЛАМПА НАПОЛЬНАЯ', 'ПОДСВЕЧНИК', 'СВЕЧА',
  'ЧАСЫ НАСТЕННЫЕ', 'БУДИЛЬНИК', 'КАЛЕНДАРЬ НАСТЕННЫЙ', 'КАРТИНА', 'ФОТОРАМКА', 'ВАЗА', 'ГОРШОК ДЛЯ ЦВЕТОВ', 'ПОДНОЖКА', 'СУШИЛКА ДЛЯ ПОСУДЫ', 'МЫЛО ХОЗЯЙСТВЕННОЕ',
  'ЩЕТКА ДЛЯ ОБУВИ', 'РОЛИК ДЛЯ ОДЕЖДЫ', 'САЛФЕТКА МИКРОФИБРА', 'ПЕРЕКЛЮЧАТЕЛЬ СВЕТА', 'ВЫКЛЮЧАТЕЛЬ', 'РОЗЕТКА', 'УДЛИНИТЕЛЬ СЕТЕВОЙ', 'ФИЛЬТР СЕТЕВОЙ', 'ЛАМПОЧКА НАКАЛИВАНИЯ', 'ЛАМПОЧКА СВЕТОДИОДНАЯ',
  'ПРИЩЕПКА', 'ВЕРЕВКА ДЛЯ БЕЛЬЯ', 'ШНУР ДЛЯ БЕЛЬЯ', 'КРЮЧОК ДЛЯ БЕЛЬЯ', 'ПЛАСТИКОВЫЙ ЯЩИК', 'ПАКЕТ ДЛЯ МУСОРА', 'БУМАЖНОЕ ПОЛОТЕНЦЕ', 'СРЕДСТВО ДЛЯ МЫТЬЯ ПОСУДЫ', 'ПРАВИЛО ДЛЯ СТЕКЛА', 'СКРЕБОК ДЛЯ СТЕКЛА',
  'КРЮЧОК ДЛЯ ПОЛОТЕНЕЦ', 'ДЕРЖАТЕЛЬ ДЛЯ ЩЕТОК', 'ЩЕТКА ДЛЯ ТУАЛЕТА', 'КОВРИК ДЛЯ ТУАЛЕТА', 'НАВОЛОЧКА', 'ПРОСТЫНЬ', 'ПОКРЫВАЛО', 'ПЛЕД ВЯЗАНЫЙ', 'ЧЕХОЛ ДЛЯ ПОДУШКИ', 'ЧЕХОЛ ДЛЯ МАТРАСА',
  'ОРГАНАЙЗЕР ДЛЯ ЯЩИКА', 'РАЗДЕЛИТЕЛЬ ДЛЯ ЯЩИКА', 'ПОДСТАВКА ДЛЯ НОЖЕЙ', 'МЕЛЬНИЦА ДЛЯ СОЛИ', 'МЕЛЬНИЦА ДЛЯ ПЕРЦА', 'СУШИЛКА НАСТОЛЬНАЯ', 'ФОРМА ДЛЯ ЛЬДА', 'КОНТЕЙНЕР ДЛЯ ЕДЫ', 'ЛАНЧБОКС', 'БУТЫЛКА ДЛЯ ВОДЫ',
  'КУХОННЫЕ ПЕРЧАТКИ', 'РЕЗИНОВЫЕ ПЕРЧАТКИ', 'ФАРТУК', 'ПРИХОЖАЯ ПОЛКА', 'КЛЮЧНИЦА НАСТЕННАЯ', 'МЕТЛА', 'ТРЯПКА', 'САЛФЕТКА ХОЗЯЙСТВЕННАЯ', 'ЩЕТКА ДЛЯ ПЫЛИ', 'ПЫЛЬНИК',
  'КЛЕЙ', 'СКОТЧ', 'РУЧКА', 'КАРАНДАШ', 'ЛАСТИК', 'ЛИНЕЙКА', 'ТЕТРАДЬ', 'ПАПКА', 'КОНВЕРТ', 'СКРЕПКА',
  'СТЕПЛЕР', 'СКОБЫ ДЛЯ СТЕПЛЕРА', 'КАНЦЕЛЯРСКИЙ НОЖ', 'ПОДЛОЖКА ДЛЯ РЕЗКИ', 'КАНЦЕЛЯРСКИЕ КНОПКИ', 'ЗАПИСКИ ЛИПКИЕ', 'БЛОКНОТ', 'БУМАГА', 'АЛЬБОМ ДЛЯ РИСОВАНИЯ', 'ПОДСТАВКА ДЛЯ КНИГ'
];

// Filter out anything that already exists (by normalized form) or that is clearly electronic/tech (we keep household only)
const techHints = /\b(телевизор|компьютер|ноутбук|принтер|сканер|телефон|пульт|радио|лампочк[аи]|увлажнитель|роутер|роутер|маршрутизатор|холодильник|микроволновка|пылесос|стиральная машина)\b/i;

const uniqueToAdd = [];
const seen = new Set();
for (const raw of candidates) {
  const norm = normalizeForSet(raw);
  if (!raw || seen.has(norm)) continue;
  if (existingNorms.has(norm)) continue;
  if (techHints.test(raw)) continue;
  seen.add(norm);
  uniqueToAdd.push(raw);
}

const toAppend = uniqueToAdd.slice(0, 100);

if (toAppend.length < 100) {
  console.warn(`Only ${toAppend.length} unique household items available (requested 100). Appending what we have.`);
}

const block = toAppend.map(toCsvEntry).join('\n');
fs.appendFileSync(csvPath, (fs.readFileSync(csvPath, 'utf8').trim().length ? '\n' : '') + block + '\n');

console.log(`Appended ${toAppend.length} household entries to public/words.csv`);
