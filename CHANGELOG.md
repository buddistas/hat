# История изменений - Hat Web

## [21.09.2025] - Исправление отображения слов и позиционирования кнопок

### Исправлено
- **Проблема с кнопками**: Кнопки "Верно" и "Пропуск" больше не сдвигаются вниз при отображении длинных слов
- **Проблема с переносом слов**: Слова теперь переносятся только по целым словам, а не по слогам
- **Проблема с фразами**: Длинные фразы корректно отображаются с переносом по словам

### Добавлено
- Новый CSS класс `.game-content` для лучшей структуры игрового экрана
- Ограничение максимальной высоты блока с текущим словом (200px на десктопе, 150px на мобильных)
- Прокрутка для очень длинных слов при необходимости
- Улучшенная адаптивность для мобильных устройств

### Изменено
- **CSS структура**: Изменен `.game-area` для использования `justify-content: space-between`
- **Перенос слов**: Заменен `word-break: break-word` на `word-break: keep-all`
- **HTML структура**: Добавлен блок `.game-content` для обертки таймера и слова
- **Мобильные стили**: Обновлены для корректной работы с новой структурой

### Технические детали
- **Файлы**: `public/index.html`
- **CSS свойства**: `word-break: keep-all`, `overflow-wrap: break-word`, `line-height: 1.2`
- **Структура**: Flexbox с фиксированным позиционированием кнопок

### Результат
✅ Кнопки управления зафиксированы внизу экрана, слова отображаются корректно без разрыва по слогам, улучшен пользовательский опыт на всех устройствах.

---

## [21.09.2025] - Дедупликация словаря и улучшение завершения работы сервера

### Исправлено
- **Критическая проблема**: Удалены дублирующиеся слова из игрового словаря
- **Проблема**: В словаре было найдено 6 дубликатов: "картина", "сумка", "рубашка", "зеркало", "салат", "кефир"
- **Решение**: Автоматическое удаление дубликатов с сохранением резервной копии

### Добавлено
- Функция `normalizeWord()` для нормализации слов согласно плану проекта
- Функция `checkForDuplicates()` для проверки точных и нормализованных дубликатов
- Автоматическая проверка дубликатов при загрузке словаря в `server.js`
- Улучшенная обработка завершения работы сервера с корректным закрытием WebSocket соединений
- Резервное копирование словаря перед изменениями

### Изменено
- Обновлен `public/words.csv`: количество слов уменьшено с 252 до 246 (удалено 6 дубликатов)
- Улучшена обработка сигнала `SIGINT` в `server.js` для корректного завершения работы
- Добавлено принудительное завершение через 5 секунд при зависании сервера

### Технические детали
- **Файлы**: `server.js`, `public/words.csv`, `public/words_backup_*.csv`
- **Ключевые функции**: `normalizeWord()`, `checkForDuplicates()`
- **Нормализация**: lowerCase → trim → замена "ё"→"е" → удаление пунктуации → схлопывание пробелов

### Результат
✅ Словарь очищен от дубликатов, сервер корректно завершает работу, добавлена защита от дубликатов в будущем.

---

## [21.09.2025] - Исправление логики переноса времени

### Исправлено
- **Критическая ошибка**: Логика переноса времени между раундами теперь учитывает только фактическое игровое время
- **Проблема**: Первоначальная реализация включала паузы между раундами в расчет перенесенного времени
- **Решение**: Использование `timerState.remainingTime` вместо текущего клиентского времени

### Добавлено
- Функция `calculateCarriedTime()` для корректного вычисления перенесенного времени
- Функция `endRoundByWordsExhausted()` для правильного завершения раунда по исчерпанию слов
- Отслеживание времени начала раунда (`roundStartTime`)
- Отслеживание времени пауз (`pausedDuration`, `pauseStartTime`)

### Изменено
- Обновлена функция `startTimer()` для фиксации времени начала раунда
- Обновлены функции `pauseTimer()` и `resumeTimer()` для отслеживания пауз
- Обновлена обработка события `round_completed` с проверкой состояния таймера
- Разделена логика завершения раунда по истечению времени и по исчерпанию слов

### Технические детали
- **Файлы**: `public/index.html`, `ProjectPlan.md`, `TIME_CARRY_IMPLEMENTATION.md`
- **Ключевые функции**: `calculateCarriedTime()`, `endRoundByWordsExhausted()`
- **Состояние таймера**: Добавлены поля `roundStartTime`, `pausedDuration`, `pauseStartTime`

### Результат
✅ Перенос времени теперь работает корректно и учитывает только фактическое игровое время, исключая паузы между раундами.

---

## [Предыдущие версии]

### Первоначальная реализация
- Базовая логика переноса времени на клиенте
- Использование localStorage для хранения перенесенного времени
- Интеграция с серверной логикой для совместимости
